---
layout: post
title: PST Julekalender
description: >
  PST (Politiets Sikkerhetstjeneste) hadde i 2019 en julekalender. Den ble annonsert via en fiktiv annonse for
  NPST (Norpolar Sikkerhetstjeneste), som hadde en jobbannonse etter midlertidig stilling som snikende alvebetjent.
  Dette er en gjennomgang av julekalenderen som var en full CTF. 
---
# 2019 - NPST utlyser en midlertidig stilling som snikende alvebetjent
* this unordered seed list will be replaced by toc as unordered list
{:toc}
## Introduksjon
![Eksempel p√• annnonse](/assets/img/blog/2020-npst/ad.jpeg)
Mot slutten av november i 2019 ble det sluppet en del stillingsannonser og [artikler](https://www.vg.no/nyheter/innenriks/i/JowQQb/pst-soeker-snikende-alvebetjent-paa-svalbard) 
om NPST som utlyser en midlertidig stilling som snikende alvebetjent. Etter √• ha g√•tt igjennom en del av stillingsannonsene, 
Kunne man finne en [faktisk link](https://npst.no/) til starten av en veldig g√∏y CTF arrangert av [PST](https://www.pst.no/).
Man kunne nok ha gjettet seg fram til domenet ogs√•.

![Forsiden til NPST julekalender](/assets/img/blog/2020-npst/npst-start.png)
Her var en liten intro video, en link til en webcruiter annonse, og en link til den faktiske kalenderen.
![kalender startside](/assets/img/blog/2020-npst/kalender.png)
Hver dag kl 00:00 √•pnes en ny luke og en ny oppgave. Jeg tenkte til √• begynne med √• l√∏se oppgavene n√•r de √•pnet, 
men s√• raskt at jeg ikke hadde nok erfaring, for det var alltid noen som hadde l√∏st oppgavene p√• betydelig kortere
tid enn meg, s√• jeg sluttet raskt med √• l√∏se oppgaver p√• natten. Jeg var forn√∏yd hvis jeg fikk l√∏st alle oppgavene.

Python koden er kun testet at fungerer, den er ikke ryddet opp i, s√• den er ikke akkurat optimal. ü§™  

## Luke 1
###  Velkommen til NPST (10)
    De dagene det blir ytret √∏nske om din ekspertise, trenger vi at du svarer i NPSTs intranett. 
    Svarene vi ofte er p√• jakt etter pleier √• v√¶re p√• formen PST{noenTilfeldigeBokstaver}. 
    Avvik vil tydelig annonseres. For √• kunne legge inn besvarelser der m√• du opprette en bruker. 
    Pass p√• √• benytte en epost der det er mulig √• kontakte deg dersom du √∏nsker √• delta i k√•ringene ukens ansatt 
    og √•rets alvebetjent (se praktisk info lenger nede).
    
    Intranettet finner man her: https://intranett.npst.no.
    
    Etter du har laget deg en bruker i intranettet trenger vi ogs√• at du logger deg p√• et 
    litt eldre system du finner her: 
    https://login.npst.no. Vi har ikke helt f√•tt klarhet i hva dette systemet brukes til, 
    men vi tror du skal kunne logge inn med f√∏lgende brukernavn og passord:
    
    Brukernavn: bruker
    Passord: Advent2019


F√∏rste oppgave er √• lage seg en bruker i CTF l√∏sningen som brukes, deretter f√•r man oppgitt brukernavn og passord til 
[https://login.npst.no](https://login.npst.no). Dette gir deg flagget.  
    
    ‚ñà‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  
    ‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïê‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù  
    ‚ñà‚ñà‚ïî‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ïë    
    ‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë   
    ‚ñà‚ñà‚ïë ‚ïö‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë   
    ‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïù     ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù   ‚ïö‚ïê‚ïù   
    
    Brukernavn: bruker
    Passord: Advent2019
    
    Velkommen!
    L√∏sningen p√• oppgaven er PST{a7966bf58e23583c9a5a4059383ff850}.
    
    Du m√• endre passordet ditt.
    
    Nytt passord: 

Flagg: PST{a7966bf58e23583c9a5a4059383ff850}
{:.note}

### Velg passord (15)
    Gratulerer!    
    N√• er det p√• tide √• bytte passord p√• brukeren din. 
    Gjeldende passord policy er kjent for √• v√¶re litt kranglete, s√• lykke til!
      
Det ser her ut til at det er regler som m√• f√∏lges, etter litt pr√∏ving og feiling ser det ut til at regelsettet er:

    Passordet m√• inneholde minst ett tegn fra hver av de f√∏lgende gruppene:
     - [a-z]
     - [A-Z]
     - [0-9]
     - [*@!#%&()^~{}]
    Tegnene i passordet m√• skrives i stigende ASCII-verdi.
    Summen av ASCII-verdier modulo 128 m√• v√¶re lik 24.

Et lite python program er en l√∏sning or √• finne et nytt gyldig passord, 

~~~python
# file: "findpw.py"
import string
pw = ''

def checkGroups(attempt):
    lower = False
    upper = False
    number = False
    special = False
    for c in attempt:
        if c in string.lowercase:
            lower = True
            continue
        if c in string.uppercase:
            upper = True
            continue
        if c in string.digits:
            number = True
            continue
        if c in '*@!#%&()^~{}':
            special = True
            continue

    return lower and upper and number and special

def checkAscending(attempt):
    last = 0
    for c in attempt:
        o = ord(c)
        if o <= last:
            return False
        last = o
    return True

def checkModulo(attempt):
    # now check the modulo according to the rules.
    sum = 0
    for c2 in attempt:
        sum += ord(c2)
    if sum % 128 == 24:
        return True
    return False

for c in string.printable:
    for c2 in string.printable:
        for c3 in string.printable:
            for c4 in string.printable:
                pw = c + c2 + c3 + c4
                asc = checkAscending(pw)
                if not asc:
                    continue
                modCorrect = checkModulo(pw)
                if not modCorrect:
                    continue
                groupCorrect = checkGroups(pw)
                if not groupCorrect:
                    continue
                print(pw)
~~~

Det f√∏rste og beste passordet `0@Ag` gir oss flagg 2.

    Passordet kunne ikke bli endret p√• n√•v√¶rende tidspunkt.
    Pr√∏v igjen p√• ny√•ret!
    
    PST{6a0f0731d84afa4082031e3a72354991}

Flagg: PST{6a0f0731d84afa4082031e3a72354991}
{:.note}

### Passordgjenoppretting (20)
    En tidligere ansatt m√•tte slutte etter √• ha endt opp p√• listen over slemme barn. 
    Dessverre glemte vi √• be han kopiere ut filene sine f√∏r han sluttet, og vi har f√∏lgelig ikke passordet.  
    Dette er det vi har av info:  
          Brukernavn: admin  
          ???: 42f82ae6e57626768c5f525f03085decfdc5c6fe  
    Klarer du √• logge inn p√• kontoen?

Her har vi f√•tt oppgitt en hash, [hash-identifier](https://code.google.com/archive/p/hash-identifier/) sier at det sannsynligvis er en [SHA-1](https://en.wikipedia.org/wiki/SHA-1), 
s√• her bruker jeg [hashcat](https://hashcat.net/hashcat/). 
Min mangel p√• erfaring gj√∏r her at jeg begynner i feil ende og kaster bort mye tid.
Jeg pr√∏ver √• cracke den med [rockyou](https://en.wikipedia.org/wiki/RockYou), alle passordlister i [seclists](https://github.com/danielmiessler/SecLists), alle [rules](https://www.notsosecure.com/one-rule-to-rule-them-all/) som ligger default i hashcat p√• alle 
p√• alle foreg√•ende passordlister, men f√•r ikke noe resultat. 
Som et siste desperat fors√∏k setter jeg p√• en bruteforce, med en plan om √• la den st√• over natten. 
2 sekunder senere har den funnet passordet. üòí

~~~bash
$ hashcat -m 100 -a 3 -1 ?a hash ?1?1?1?1
~~~
    Velkommen! 
    Systemet er deaktivert grunnet julestri. 
    Frem til nytt√•r kan du n√• filene dine her:
    - l√∏sning.txt
    - notater.jpg
L√∏sning.txt inneholder flagget vi er p√• jakt etter:

    ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïó      ‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó    
    ‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù ‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù ‚ñà‚ñà‚ïó
    ‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ñà‚ïó‚ïö‚ïê‚ïù
    ‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù  ‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïó
    ‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ïö‚ïê‚ïù
    ‚ïö‚ïê‚ïù     ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù  ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù                                                 
    PST{36044221cd3e991ffc56eb2f1e368ca0}


Flagg: PST{36044221cd3e991ffc56eb2f1e368ca0}
{:.note}
notater.jpg er et bilde av en pult med en datamaskin, en kopp, en gr√∏tsk√•l 
og en gul lapp med informasjon `IV PS ‚öôÔ∏è` det skal vise seg at vi f√•r bruk for senere.

## Luke 2
    Oppdatert reiser√•d

    Det vurderes som h√∏y risiko √• medbringe tjenestetelefon til SYDPOLARE str√∏k. 
    Det er lett for fremmede makters etterretningstjenester √• ta seg inn i mobiltelefoner og nettbrett. 
    En alvebetjents telefon kan gi god innsikt i NPSTs virke, og inneholde sensitiv informasjon.

    I et utenlandsk mobilnett vil all kommunikasjon til og fra enheten kunne avlyttes, 
    uten at brukeren av mobiltelefonen kan oppdage det. NPST anser det som rimelig temmelig sannsynlig 
    at slik kapasitet er etablert p√• permanent basis i mobilnettverkene og internett i SYDPOLARE omr√•der. 
    NPST tilbyr sikkerhetsbriefer til alvebetjenter 
    og andre offentlige tjenestepersoner i forkant av reiser til h√∏yrisikoomr√•der.

    Barn i omr√•der under SYDPOLAR kontroll b√∏r sende sine √∏nskelister 
    til Jule Nissen gjennom trygge krypterte kanaler.
    
Ingen oppgaver denne dagen.
## Luke 3 - PPK (0)
    Elektronisk krypteringsmaskin
    
    NPST har avdekket at den norske overv√•kingstjenesten overtok 
    en rekke ENIGMA maskiner etter den tyske okkupasjonsmakten. 
    ENIGMA ble i stort omfang benyttet av de fleste tyske milit√¶re styrker til b√•de kryptering og dekryptering 
    av informasjon under andre verdenskrig. Den var enkel √• bruke, og antatt √• v√¶re umulig √• knekke. 
    Dette var hoved√•rsaken til dens utbredelse. 
    ENIGMA ble benyttet av den norske overv√•kingstjenesten som en reservel√∏sning frem til 1960.
    
    Som ledd i skjermingen av √∏nskelister har NPST vurdert 
    √• ta i bruk ENIGMA som erstatning for dagens krypteringsprosedyre. 
    Grunnet manglende EDB-entusiasme i grasrota m√∏ter dette stor motstand, 
    da medbragt EDB-utstyr ute i felt er sv√¶rt lite popul√¶rt. 
    Det har blitt ytret √∏nske om √• beholde dagens penn-og-papir-kryptering (PPK), 
    men det er uvisst hvor sikkert dette er. Kunne noen fors√∏kt √• knekke f√∏lgende PPK-kode:
    
    KNO fmwggkymyio√•n 30√•6√∏8432√¶√•54710a9√¶09a305√•7z9829 fmwggkymyio√•n ngpoo
    
    Skriv gjerne svaret i intranettet.

Penn og papir kryptering er h√∏yst sannsynlig en enkel krypteringsm√•te, [cyberchef](https://gchq.github.io/CyberChef/) er mitt goto tool for exploration.
Her viser det seg √• v√¶re en veldig enkel [Caesar cipher](https://en.wikipedia.org/wiki/Caesar_cipher): ROT5. 
Cyberchef har ikke st√∏tte for √¶√∏√•, men det er raskt √• manuelt ta de bokstavene som havner i det omr√•det.  

Flagg: PST{30e6d8432ce54710f9c09f305e7b9829}
{:.note}

## Luke 4
    √ònskelister p√• avveie
    Takket v√¶re mange tilbakemeldinger har NPST konkludert med at 
    krypteringen brukt p√• √∏nskelistene ikke er tilstrekkelig. 
    Alvebetjent Methi viste med sin kl√∏kt at det var mulig √• knekke koden p√• under 10 minutter! 
    Jule NISSEN vil ogs√• takke f√∏lgende alvebetjenter for rask utf√∏relse (under 60 minutter):

    unblvr, fjank, ameneon, Furris, kristaver, TrustedInstaller, bjarneUbetjent, lokling, 
    endrelem, sayco, StianS, Olga, ColdCoffeeCup, vidarli, stiffi, potetsos, jallasprit, 
    57ur14, zup, pask, grobert, Noldus og atletiskj.

    Med dette som bakteppe har NPST mistanke om at √∏nskelistene til 453 barn er p√• avveie. 
    Det er grunn til √• tro at sydpolare hackere st√•r bak.
    NISSEN er p√• joggreise, men vil ta tak i problemet s√• snart han har returnert.

    Overtidspepperkaker
    Det har den siste tiden v√¶rt stor p√•gang etter normal arbeidstid, spesielt rundt midnatt. 
    Dette har g√•tt hardt utover overtidsbudsjettet. NISSEN vil vurdere tiltak for √• redusere disse kostnadene.
    
Ingen oppgaver denne dag, men jeg har f√•tt en takk fra Jule NISSEN, og ligger i hovedfeltet! üòÇ 

## Luke 5 - üêíi (5)
    Oppdatering p√• √∏nskeliste-lekkasje

    Ytterligere 72 √∏nskelister ser ut til √• v√¶re p√• avveie.
    NISSEN jobber p√• spreng for √• utvikle en ny uknekkelig PPK.

    Kranglete API
    V√•re analytikere har gravd litt i et system en tidligere ansatt jobbet med f√∏r avskjedigelse. 
    Noen av adventsvikarene er kjent med personen fra tidligere 
    gjennom uthenting av filer og gjenoppretting av passord. 
    Det ser ut til at systemet er skrevet i node.js, 
    men analytikerne v√•re greier ikke helt skj√∏nne hvordan det fungerer. 
    Det finnes heller ikke noen dokumentasjon. 
    Kunne noen EDB-kompetente alvebetjenter sett n√¶rmere p√• dette, 
    og rapportert tilbake i intranettet om det ligger noe av interesse der?

    https://npst.no/api/üôÉ.js

    Julevurdering
    Med bakgrunn i √∏nskelistelekasjen er julevurderingen nedgradert. Det er n√• MULIG at det blir en GOD JUL.

Ved √• √•pne denne url f√•r vi en json tilbake:
~~~json
{
  "error":false,
  "state":"[>üçï<, üçâ, üê¥, üêü, üöÄ, üö©]",
  "message":"Bruk /api/üôÉ.js?commands=ü§∑ for en üìÉ over üëå ,nüöΩer."
}
~~~
Oversatt til: hjelp for en liste over ok kommandoer. Javel, la oss pr√∏ve `/api/üôÉ.js?commands=ü§∑ `.
~~~json
{ "error":false,
  "state":"[>üçï<, üçâ, üê¥, üêü, üöÄ, üö©]",
  "message":"Tilgjengelig ,nüöΩer: ‚ú®, ‚ö°, üîë, ü§∑. Eksempel: /api/üôÉ.js?commands=‚ú®‚ö°‚ú®"
}
~~~
Jaha, la oss pr√∏ve `/api/üôÉ.js?commands=‚ú®‚ö°‚ú®` da.
~~~json
{
  "error":false,
  "state":"[üçï, >üêü<, üö©, üöÄ, üçâ, üê¥]",
  "message":""
}
~~~
S√•, her kan man fors√∏ke √• forst√• hvordan dette g√∏ye api'et fungerer, for det er jo et flagg i state verdien, 
det ser ut til at en av verdiene i state er valgt, s√• oppgaven er nok √• f√• valgt flagget.
Jeg fors√∏ker _ikke_ √• forst√• dette, jeg lager meg et rudiment√¶rt brute force python program.
Etter kort tid finner jeg flagget p√• bl.a. command `‚ö°‚ö°‚ö°‚ö°‚ú®üîë`                                                                                  
~~~json
{
  "error":false,
  "state":"[üêü, üöÄ, üçâ, üê¥, >üö©<, üçï]",
  "message":"PST{ba323c3f5b3f1b536461d41cc7f1ba60}"
}
~~~

Flagg: PST{ba323c3f5b3f1b536461d41cc7f1ba60}
{:.note}


~~~python
# file: "brute-flag.py"
# -*- coding: utf-8 -*-
import requests, codecs, sys
UTF8Writer = codecs.getwriter('utf8')
sys.stdout = UTF8Writer(sys.stdout)

validChars = u'‚ú®‚ö°üîëü§∑'


for c in range(0, 3):
    print validChars[c]
    response = requests.get(u'https://npst.no/api/üôÉ.js?commands='+ validChars[c])
    print(response.text)
    for d in range(0, 3):
        print validChars[c] + validChars[d]
        response = requests.get(u'https://npst.no/api/üôÉ.js?commands='+ validChars[c]+validChars[d])
        print(response.text)
        for e in range(0, 3):
            print validChars[c] + validChars[d] + validChars[e]
            response = requests.get(u'https://npst.no/api/üôÉ.js?commands='+ validChars[c]+validChars[d]+validChars[e])
            print(response.text)
            for f in range(0,3):
                print validChars[c] + validChars[d] + validChars[e]+validChars[f]
                response = requests.get(u'https://npst.no/api/üôÉ.js?commands='+ validChars[c]+validChars[d]+validChars[e]+validChars[f])
                print(response.text)
                for g in range(0,3):
                    print validChars[c] + validChars[d] + validChars[e]+validChars[f]+validChars[g]
                    response = requests.get(u'https://npst.no/api/üôÉ.js?commands='+ validChars[c]+validChars[d]+validChars[e]+validChars[f]+validChars[g])
                    print(response.text)
                    for h in range(0,3)
                        print validChars[c] + validChars[d] + validChars[e]+validChars[f]+validChars[g]+validChars[h]
                        response = requests.get(u'https://npst.no/api/üôÉ.js?commands='+ validChars[c]+validChars[d]+validChars[e]+validChars[f]+validChars[g]+validChars[h])
                        print(response.text)
~~~

## Luke 6 - PPKv2 (5)
    Ny pr053dyr3 f0r kryp73ring

    NI553N h4r f√•77 p√• p1455 ny PPK. K4n ni553n3 hj31p3r3 v3rifi53r3 4t k0d3n 3r ukn3kk31ig?

    KNO fmw55k8m7i179 z98√∏y√•z8√¶y67a√•y0√•6√¶7a√∏1√•1438√•a5a fmw55k8m7i179 95p11

Her ser det ogs√• ut til at det er en standard Caesar Cipher, og et sterkt hint til at [l33t](https://simple.wikipedia.org/wiki/Leet) er brukt i tillegg.
Standard rotering gir oss imidlertid bare s√∏ppel, men roterer vi sm√•/store bokstaver for seg selv (ROT5) og tall for seg selv, 
s√• kommer l√∏sningen av seg selv: `PST kr√∏11p4r3n735 b54daeb4ca23fea6e2c3fd7e7094ef1f kr√∏11p4r3n735 51u77` skrevet i l33t.
Det var for√∏vring ikke mulig √• l√∏se denne til √• begynne med, iom at det faktisk var en feil i hashen som var lagt ut. 
Alikevel var det noen som hadde l√∏st den, se en fantastisk forklaring p√• hvordan [her](https://github.com/myrdyr/ctf-writeups/tree/master/npst).

Flagg: PST{b54daeb4ca23fea6e2c3fd7e7094ef1f}
{:.note}

~~~python
# file: "solver.py"
destriptio2 = 'Ny pr053dyr3 f0r kryp73ring\
NI553N h4r f√•77 p√• p1455 ny PPK. K4n ni553n3 hj31p3r3 v3rifi53r3 4t k0d3n 3r ukn3kk31ig?'


description = 'Ny pr053dyr3 f0r kryp73ring\
NI553N h4r f√•77 p√• p1455 ny PPK. K4n ni553n3 hj31p3r3 v3rifi53r3 4t k0d3n 3r ukn3kk31ig?'

# Seems like a standard rot 5, but the devil is in the details...
codeo = 'kno fmw55k8m7i179 z98√∏y√•z8√¶y67a√•y0√•6√¶7a√∏1√•1038√•a5a fmw55k8m7i179 95p11'
coded = 'KNO fmw55k8m7i179 z98√∏y√•z8√¶y67a√•y0√•6√¶7a√∏1√•1438√•a5a fmw55k8m7i179 95p11'

original = 'abcdefghijklmnopqrstuvwxyz√¶√∏√•ABCDEFGHIJKLMNOPQRSTUVWXYZ√Ü√ò√Ö'
rotated = 'fghijklmnopqrstuvwxyz√¶√∏√•abcdeFGHIJKLMNOPQRSTUVWXYZ√Ü√ò√ÖABCDE'

leetOriginal =  '0123456789'
leetTranslat1 = '0123456789'

def rotCharsAndNUmbers(chars):
    rv = ''
    for pos, c in enumerate(chars):
        # skip space
        if c == ' ':
            rv += c
            continue
        # skip numbers
        if c in '0123456789':
            num = int(c) + 6
            if num > 9:
                num = num - 10


            rv += str(num)
            continue
        # skip unknown
        if (c < 'a' or c > 'z') and c not in '√¶√∏√•√Ü√ò√Ö' and (c < 'A' or c > 'Z'):
            rv += c
            continue
        idx = original.index(c)
        rv += rotated[idx]
    return rv


def antiLeet(chars, leetTranslat):
    rv = ''
    for pos, c in enumerate(chars):
        # skip space
        if c == ' ':
            rv += c
            continue
        # skip numbers
        if c not in '0123456789':
            rv += c
            continue

        idx = leetOriginal.index(c)
        result = leetTranslat[idx]
        if result not in '0123456789abcdefEAB':
            rv += c
        else:
            rv += result
    return rv


print(coded)
rot = rotCharsAndNUmbers(coded)
print(rot)

trans = antiLeet(rot, leetTranslat1)
#print(trans)
~~~


## Luke 7
### Nissens verksted (3)
    Ukens ansatt
    Jule NISSEN gratulerer unblvr som ukens ansatt, og takker for ekstraordin√¶r innsats. 
    NISSENS sekretariat har tatt kontrakt via elektronisk post.

    Korrigering av g√•rsdagens dagsbrief
    NISSEN vil ogs√• takke en dyktig alvebetjent som har gjort NPST oppmerksom p√• 
    en feil i den krypterte teksten g√•rsdagens dagsbrief. Denne er n√• korrigert.

    Begrensinger i intranettet
    Som noen kanskje har f√•tt med seg har vi innskrenket antall svar som kan skrives i intranettet. 
    Etter noen ivrige alvebetjenter hadde lagt inn s√• mange svar at NISSEN ikke orket √• lese alle svarene, 
    s√• han seg n√∏dt til √• sette en begrensning p√• 1000 svar.

    Digitalisering
    Som del av nordpolar digitaliseringsstrategi har NPST i det siste jobbet med √• digitalisere NISSENS verksted. 
    Der foreg√•r alt av design og snekring for √• lage gaver til snille barn, 
    men vi har misstanke om at vi har mistet et flagg der inne. 
    Kunne noen alvebetjenter tatt en titt og sett om de finner det?

    https://verksted.npst.no

    Julevurdering
    Det er n√• SANNSYNLIG at det blir en GOD JUL.

P√• juleverkstedet finner vi en sinnsvak liste av bilder. Etter litt analysering, s√• kan man se at det er ikke bare forskjellige
bilder, det er en liste av ca 2340 bilder. Isteden for √• lete etter det ene bildet av et flagg, s√• skriver jeg et program
som henter ut alle bilder det er kun ett av. Nedlasting av bilder gj√∏r jeg enkelt og greit med firefox, "save as".
N√•r jeg n√• har en liste med 3 bilder, er det enkelt. En sko, en pingvin og ett flagg. Flagget er l√∏sningen.  

Flagg: PST{8798e1f0a271b09750a6531686fc621b}
{:.note}

Kode:
~~~python
# file: "solver.py"
# get the filenames
import hashlib
from os import listdir
from os.path import isfile, join

hashes = {""}
mypath = '.'
filenames = [f for f in listdir(mypath) if isfile(join(mypath, f))]

counts = {'': 0}
print(len(filenames))
for name in filenames:
    file = open(mypath + "/" + name, 'rb').read()
    hexdigest = hashlib.md5(file).hexdigest()
    if hexdigest not in counts:
        counts[hexdigest] = 1
    else:
        counts[hexdigest] = counts[hexdigest] + 1

for count in counts:
    if counts[count] == 1:
        print(count)
~~~

### Bedriftsspionasje (2)
    V√•re analytikere mistenker at det ogs√• kan foreg√• spionasje mot Nissens verksted. 
    Kan du ta en ny titt og se om du finner noe muffens?

Tjah, kan jo v√¶re den teite pingvinen? Pingviner h√∏rer jo ikke til p√• Nordpolen. Jupp, det var det.  

Flagg: PST{b30b4add25b97721ebf0e7ad2eb26eb9}
{:.note}

## Luke 8
### 8. desember (10)
![strava.png](/assets/img/blog/2020-npst/8-strava.png)
    
    Lokalisering av isbj√∏rn

    Den 4. desember dro Jule NISSEN og Rudolf R√òDNESE p√• joggetur til postkontoret 
    for √• hente jule√∏nsker fra snille barn. 
    Etter en noe turbulent sledetur if√∏rte de seg NPSTs nye treningskl√¶r og jogget fra sledeplassen til postkontoret. 
    P√• turen tok Rudolf R√òDNESE en liten omvei, hvor han observerte en mistenkelig isbj√∏rn. 
    Uheldigvis greier ikke Rudolf R√òDNISSE √• huske hvor han befant seg da han observerte isbj√∏rnen.

    Kan en alvebetjent se n√¶rmere p√• dette, og rapportere tilbake lokasjonen til isbj√∏rnen i intranettet?

    Rudolf R√òDNESE vil helst ha lokasjonen til isbj√∏rnen (s√• n√∏yaktig som mulig) 
    i uppercase, inklusive mellomrom, omgitt av PST{ og }.

    Eksempel: Julenissens verksted ‚Üí PST{JULENISSENS VERKSTED}.

Etter en liten bomtur innom [steganografi](https://en.wikipedia.org/wiki/Steganography) p√• bildet, s√• er det p√• tide √• ta en titt p√• 
[strava](https://www.strava.com/) siden det ser ut til at julenissen bruker strava.
Joda, b√•de Rudolf R√∏dnese og Jule Nissen er p√• Strava, og de logger turene sine public. p√• den 4 desember ser det et til 
at rudolf faktisk tok en omvei via North Pole Expedition Museum (Google Maps). Det er faktisk en isbj√∏rn foran der...  

Flagg: PST{NORTH POLE EXPEDITION MUSEUM}
{:.note}

### Spionaktivitet (15)
    Det har kommet tips om mulig spionaktivitet utf√∏rt av s√∏rpolare agenter p√• 
    Svalbard i tidsrommet Nissen og Rudolf var p√• l√∏petur.
    Kan du identifisere en agent?

Ved √• bruke strava flyby, s√• kan vi se enda en teit pingvin (Pen Gwyn), som var ute p√• tur, fulgte etter Rudolf og Nissen
hele tiden.
P√• hans profil finner vi flagget.  

PST{69d26031ea5dbbeb56f22d9647f7c98e}
{:.note}

### Mystiske profiler (20)
    V√•re analytikere mistenker at Pen Gwyn har rapportert hjem til sine kontakter p√• sydpolen.
    Klarer du √• dekode noe av kommunikasjonen?

Her ble det et aldri s√• lite helvete p√• natten. Det bildet vi skulle ha f√•tt for analyse, det hadde blitt fjernet, 
og noen begynte √• trolle ved √• lage enda flere falske stravaprofiler med fiktive flagg og fiktive g√•ter.
√Ö avholde konkurranser i et ikke-kontrollert milj√∏ (f.eks. Strava) er g√∏y, men har potensiale til √• bli en aldri s√• 
liten katastrofe for deltakerene.
N√•r jeg endelig fikk det korrekte bildet var det en annen sak.
Alt jeg har tilgjengelig av [stego-tools](https://github.com/DominicBreuker/stego-toolkit) ga meg nada.
Bakgrunnen i dette bildet har streker i forskjellig tykkelse. Med litt analyse kan man se at det er [morsekode](https://en.wikipedia.org/wiki/Morse_code),
en manuell dekoding av morse gir oss siste flagg.  

PST{e06531d19ff020a479520ef28c8d12c}
{:.note}
Profil bildet til Pen Gwyn inneholder ogs√• en gul lapp med informasjon `VII TF ‚öôÔ∏è`.
## Luke 9
    √ònskelistelekkasje
    NPST har funnet ut at √∏nskelistene befant seg p√• en minnepinne som en alvebetjent 
    hadde glemt igjen i Jule NISSENS reinsdyrslede. 
    Alveteknikere har overf√∏rt filene p√• minnepinnen, og √∏nskelistene er n√• forsvarlig oppbevart. 
    Alvebetjenten har blitt irettesatt for √• ha oppbevart sensitiv informasjon p√• minnepenn.
    
    Fotoarkiv
    Takket v√¶re noen dyktige alvebetjenter ble det den 8. desember avdekket mystisk aktivitet fra en sydpolar agent. 
    Et bilde lastet opp av agenten har blitt sikret, og er n√• tilgjengelig i NPSTs arkiv. 
    Det ryktes at dette kan komme til nytte n√•r man fors√∏ker √• l√∏se siste oppgave i g√•rsdagens luke.

Ingen oppgaver, men de har lagt ut det manglende bildet Luke 8. üòí

## Luke 10 - Vige vs. Nere (5)
    Sjakkmesterskap

    For tiden arrangeres polarmesterskap i sjakk p√• Nordpolen. 
    Flere av NPSTs ansatte bruker store deler av arbeidsdagen p√• √• f√∏lge med p√• mesterskapet. 
    Da mange sitter i graderte nett uten mulighet til √• str√∏mme sjakk, 
    har NISSEN valgt √• legge ved det siste partiet mellom to s√∏rpolare spillere, Vige og Nere:
    PGN:

    1. a3 e6 2. b3 Ke7 3. Ra2 d5 4. h3 h6 5. f4 Qd6 6. Nc3 Qa6 7. Nf3 g5 8. Nb1 b5 9. d4 Qa5+ 10. Bd2 Kd6 11. g4 Bg7 
    12. Bc3 f5 13. Nh2 Ba6 14. Qd2 Bc8 15. Qc1 Qb6 16. Ba1 b4 17. Nd2 Ke7 18. Ndf3 Nd7 19. axb4 Ngf6 20. gxf5 Ne5 
    21. Ng4 c5 22. Nh4 Qd6 23. Nf2 Ng8 24. Bg2 a5 25. Ra4 Qd8 26. Be4 Qe8 27. Ra3 Kf7 28. b5 Qe7 29. O-O exf5 
    30. Nxf5 Ba6 31. Ng3 Qf6 32. Nd1 Ra7 33. Kg2 Nc4 34. bxa6 Qb6 35. Nb2 Nxa3 36. Nh5 Qxb3 37. Nxg7 Nb5 38. Nd1 Qe3 
    39. Rh1 Qa3 40. Re1 Rc7 41. Ne8 Kxe8 42. Qb1 Rhh7 43. dxc5 Rce7 44. Rg1 Re5 45. fxg5 Nf6 46. gxh6 Kf8 47. a7 Ng4 
    48. Kh1 Nc7 49. Bxd5 Qb4 50. Kg2 Qa3 51. c6 Qc5 52. Qb8+ Re8 53. Be5 Ne6 54. Nc3 Rf7 55. Qxe8+ Kxe8 56. Bf4 Rf6 
    57. Bg3 Kf7 58. Be1 1-0

    Kommentarer til partiet kan legges inn i intranettet.
    
Hm, f√∏rste jeg tenker p√• er stegano og sjakk. Litt s√∏k rundt omkring gir meg et lovende resultat: [Chess steganography](https://incoherency.co.uk/chess-steg/)
men alle mine bokstaver er "jumbled around". `HHL DJDWEDESKWCLXK u02s104y2s665t5v3w2619v6184su50t CGGXDAHTJTFMWH KEMIL` 
Heldigvis f√•r jeg et kraftig hint av Roy Solberg f√∏r jeg graver meg for dypt ned i kaninhullet og begynner √• analysere
biblioteket for √• finne ut om de har modifisert det.

Sjakkspillerene heter Vige og Nere. Vigenere encryption, selvf√∏lgelig. 
Siden vi vet teksten over skal v√¶re `PST KR√òLLPARANTES` kan vi begynne med √• putte inn PST i cyberchefs vigenere decoder.
Kj√∏rer man viegnere decoding med resultatet, f√•r man n√∏kkelen.
De tre f√∏rste bokstavene er `SPS`, educated guess gir oss n√∏kkelen `SPST` (kan ogs√• bruteforce hvis man vil).  
[Her er Cyberchef linken til l√∏sningen](https://gchq.github.io/CyberChef/#recipe=Vigen%C3%A8re_Decode('SPST')&input=SEhMIERKRFdFREVTS1dDTFhLIHUwMnMxMDR5MnM2NjV0NXYzdzI2MTl2NjE4NHN1NTB0IENHR1hEQUhUSlRGTVdIIEtFTUlM).  

Flagg: PST{f02a104f2a665e5d3d2619d6184dc50a}
{:.note}
## Luke 11 - 1337 (5)
    Prim√¶re faktorer
    En av NPSTs prim√¶re oppgaver er √• overv√•ke kommunikasjonen mellom personer 
    mistenkt for √• ut√∏ve spionasje for s√∏rpolarske akt√∏rer. 
    En alvebetjent har snappet opp en melding tiltenkt en spion. Grunnet flere faktorer trenger vi hjelp 
    med √• finne ut av hva denne meldingen inneholder. Kan en alvebetjent se over meldingen og finne noen spor?

    Fors√∏k p√• sm√∏ring av alvebetjenter
    En betrodd alvebetjent har mottatt et parti med julebrus. Julebrusen var plassert utenfor NISSENS verksted 
    og adressert alvebetjenten. Det var ingen eksplisitte tegn til avsender, men mistanken er rettet mot Sydpolen 
    pga en sor pingvinfj√¶r som ble funnnet i n√¶rheten av partiet. I tr√•d med regelverk om sm√∏ring fra fremmed makt 
    har alvebetjent informert sin n√¶rmeste leder Jule NISSEN og partiet med julebrus har blitt destruert. 
    Vi oppfordrer andre alvebetjenter til ogs√• √• rapportere fors√∏k 
    der de mistenker fremmede makter fors√∏ker √• p√•virke dem.

Meldingen er en rekke av 0 og 1. En bin√¶rrekke tydeligvis. En god del fors√∏k p√• √• dekode den til ASCII
eller bin√¶rformat, morse osv gir ingen resultater. Men det finnes et m√∏nster! 
Dette hintes til av oppgavens navn: `1337`. Hvis man lagrer meldingen i en tekstfil og √•pner opp denne i en editor,
gj√∏r bredden mindre og st√∏rre, s√• vil man se et m√∏nster tre fram. Eller du kan skrive et lite python program for √• finne 
riktig linebreak.  

**Flagg: PST{LINEBREAK_IT_TILL_YOU_MAKE_IT!}**

     ‚ñà‚ñà‚ñà   ‚ñà‚ñà  ‚ñà‚ñà‚ñà‚ñà‚ñà    ‚ñà  ‚ñà     ‚ñà‚ñà‚ñà ‚ñà   ‚ñà ‚ñà‚ñà‚ñà‚ñà‚ñà ‚ñà‚ñà‚ñà‚ñà  ‚ñà‚ñà‚ñà‚ñà  ‚ñà‚ñà‚ñà‚ñà‚ñà   ‚ñà   ‚ñà   ‚ñà       ‚ñà ‚ñà‚ñà‚ñà‚ñà‚ñà       ‚ñà‚ñà‚ñà‚ñà‚ñà ‚ñà ‚ñà     ‚ñà           ‚ñà   ‚ñà  ‚ñà‚ñà‚ñà  ‚ñà   ‚ñà       ‚ñà   ‚ñà   ‚ñà   ‚ñà   ‚ñà ‚ñà‚ñà‚ñà‚ñà‚ñà       ‚ñà ‚ñà‚ñà‚ñà‚ñà‚ñà ‚ñà  ‚ñà    
     ‚ñà  ‚ñà ‚ñà  ‚ñà   ‚ñà     ‚ñà   ‚ñà      ‚ñà  ‚ñà‚ñà  ‚ñà ‚ñà     ‚ñà   ‚ñà ‚ñà   ‚ñà ‚ñà      ‚ñà ‚ñà  ‚ñà  ‚ñà        ‚ñà   ‚ñà           ‚ñà   ‚ñà ‚ñà     ‚ñà           ‚ñà   ‚ñà ‚ñà   ‚ñà ‚ñà   ‚ñà       ‚ñà‚ñà ‚ñà‚ñà  ‚ñà ‚ñà  ‚ñà  ‚ñà  ‚ñà           ‚ñà   ‚ñà   ‚ñà   ‚ñà   
     ‚ñà  ‚ñà ‚ñà      ‚ñà     ‚ñà   ‚ñà      ‚ñà  ‚ñà ‚ñà ‚ñà ‚ñà     ‚ñà   ‚ñà ‚ñà   ‚ñà ‚ñà     ‚ñà   ‚ñà ‚ñà ‚ñà         ‚ñà   ‚ñà           ‚ñà   ‚ñà ‚ñà     ‚ñà            ‚ñà ‚ñà  ‚ñà   ‚ñà ‚ñà   ‚ñà       ‚ñà ‚ñà ‚ñà ‚ñà   ‚ñà ‚ñà ‚ñà   ‚ñà           ‚ñà   ‚ñà   ‚ñà   ‚ñà   
     ‚ñà‚ñà‚ñà   ‚ñà‚ñà    ‚ñà    ‚ñà    ‚ñà      ‚ñà  ‚ñà ‚ñà ‚ñà ‚ñà‚ñà‚ñà‚ñà  ‚ñà‚ñà‚ñà‚ñà  ‚ñà‚ñà‚ñà‚ñà  ‚ñà‚ñà‚ñà‚ñà  ‚ñà   ‚ñà ‚ñà‚ñà          ‚ñà   ‚ñà           ‚ñà   ‚ñà ‚ñà     ‚ñà             ‚ñà   ‚ñà   ‚ñà ‚ñà   ‚ñà       ‚ñà   ‚ñà ‚ñà   ‚ñà ‚ñà‚ñà    ‚ñà‚ñà‚ñà‚ñà        ‚ñà   ‚ñà   ‚ñà    ‚ñà  
     ‚ñà       ‚ñà   ‚ñà     ‚ñà   ‚ñà      ‚ñà  ‚ñà  ‚ñà‚ñà ‚ñà     ‚ñà   ‚ñà ‚ñà ‚ñà   ‚ñà     ‚ñà‚ñà‚ñà‚ñà‚ñà ‚ñà ‚ñà         ‚ñà   ‚ñà           ‚ñà   ‚ñà ‚ñà     ‚ñà             ‚ñà   ‚ñà   ‚ñà ‚ñà   ‚ñà       ‚ñà   ‚ñà ‚ñà‚ñà‚ñà‚ñà‚ñà ‚ñà ‚ñà   ‚ñà           ‚ñà   ‚ñà   ‚ñà   ‚ñà   
     ‚ñà    ‚ñà  ‚ñà   ‚ñà     ‚ñà   ‚ñà      ‚ñà  ‚ñà   ‚ñà ‚ñà     ‚ñà   ‚ñà ‚ñà  ‚ñà  ‚ñà     ‚ñà   ‚ñà ‚ñà  ‚ñà        ‚ñà   ‚ñà           ‚ñà   ‚ñà ‚ñà     ‚ñà             ‚ñà   ‚ñà   ‚ñà ‚ñà   ‚ñà       ‚ñà   ‚ñà ‚ñà   ‚ñà ‚ñà  ‚ñà  ‚ñà           ‚ñà   ‚ñà       ‚ñà   
     ‚ñà     ‚ñà‚ñà    ‚ñà      ‚ñà  ‚ñà‚ñà‚ñà‚ñà‚ñà ‚ñà‚ñà‚ñà ‚ñà   ‚ñà ‚ñà‚ñà‚ñà‚ñà‚ñà ‚ñà‚ñà‚ñà‚ñà  ‚ñà   ‚ñà ‚ñà‚ñà‚ñà‚ñà‚ñà ‚ñà   ‚ñà ‚ñà   ‚ñà ‚ñà‚ñà‚ñà‚ñà‚ñà ‚ñà   ‚ñà   ‚ñà‚ñà‚ñà‚ñà‚ñà   ‚ñà   ‚ñà ‚ñà‚ñà‚ñà‚ñà‚ñà ‚ñà‚ñà‚ñà‚ñà‚ñà ‚ñà‚ñà‚ñà‚ñà‚ñà   ‚ñà    ‚ñà‚ñà‚ñà   ‚ñà‚ñà‚ñà  ‚ñà‚ñà‚ñà‚ñà‚ñà ‚ñà   ‚ñà ‚ñà   ‚ñà ‚ñà   ‚ñà ‚ñà‚ñà‚ñà‚ñà‚ñà ‚ñà‚ñà‚ñà‚ñà‚ñà ‚ñà   ‚ñà   ‚ñà  ‚ñà    



~~~python
# file: "solver.py"
binStr = '0111000110011111000010010000011101000101111101111001111001111100010001000100000001011111000000011111010100000‚èé
         10000000000010001001110010001000000010001000100010001011111000000010111110100100000100101001000100000100010000‚èé
         00100110010100000100010100010100000010100100100000000100010000000000010001010000010000000000010001010001010001‚èé
         00000001101100101001001001000000000001000100010001000010010100000010000010001000000100101010100000100010100010‚èé
         10000010001010100000000010001000000000001000101000001000000000000101001000101000100000001010101000101010001000‚èé
         00000000100010001000100001110001100001000010000100000010010101011110011110011110011110010001011000000000010001‚èé
         00000000000100010100000100000000000001000100010100010000000100010100010110000111100000000100010001000010001000‚èé
         00001000100000100010000001001001101000001000101010001000001111101010000000001000100000000000100010100000100000‚èé
         00000000100010001010001000000010001011111010100010000000000010001000100010000100001001000100000100010000001001‚èé
         00010100000100010100100100000100010100100000000100010000000000010001010000010000000000000100010001010001000000‚èé
         01000101000101001001000000000001000100000001000010000011000010000001001111101110100010111110111100100010111110‚èé
         10001010001011111010001000111110001000101111101111101111100010000111000111001111101000101000101000101111101111‚èé
         101000100010010000'
print(len(binStr))
for i in range(0,7):
    line = binStr[i*191:i*191+191]
    for ch in line:
        if ch=='0':
            print(' ', end = "")
        else:
            print('‚ñà', end = "")
    print("")
~~~


## Luke 12 - Arbitr√¶r kode (5)
    Evaluering av trusler
    NPST har oppdaget et endepunkt som er tilgjengelig p√• SPST sin offentlige nettside. 
    Det vites p√• dette tidspunktet ikke om dette endepunktet er tilgjengelig ved en feiltagelse, 
    eller om det er meningen at dette skal brukes av deres agenter. 
    En av NPSTs teknikere har p√•pekt at det ser ut til √• v√¶re mulig √• kj√∏re arbitr√¶r kode via endepunktet. 
    Det er √∏nskelig at en alvebetjent unders√∏ker dette endepunktet og rapporterer eventuelle flagg via intranettet.

    Url: https://api.spst.no/eval?eval=`<pre>${getFlag()}</pre>`

    Jule NISSEN er blitt syk
    Jule NISSEN er utilgjengelig de neste dagene grunnet sykdom. 
    Det mistenkes at sykdommen er influensa ettersom Jule NISSEN har spr√∏yteskrekk 
    og ikke tok vaksinen sammen med resten av NPST. 
    Ledelsen anbefaler alle alvebetjenter √• praktisere god hygiene og benytte seg av antibak for √• unng√• videre smitte.

    Julevurdering
    Med bakgrunn i Jule NISSENS sykdom blir julevurderingen nedgradert. Det er n√• mulig at det blir en GOD JUL.

Her f√•r vi oppgitt en url, med to enorme hint om at her er det mulig √• kj√∏re kode, og `eval=''`. 
Vi kan anta at det faktisk er en eval funksjon som kj√∏res, og node.js, et popul√¶rt server-side spr√•k har en slik funksjon.
[Burpsuite](https://portswigger.net/burp) er v√•r venn her, den gir oss full kontroll over hva som sendes til server,
uten at browseren kr√∏ller med hva vi pr√∏ver √• sende. Ved √• hente kildekoden til getFlag ser vi en kommentar om en encrypt
funksjon. Denne funksjonen henter et passord for en dato, et salt Natriumhydrogensulfat ($$ NaHSO_4 $$) og en tredje funksjon, decrypt.
S√•, ved √• se p√• passord funksjonen, ser vi at den kaller getSecretPasswordNumber med et tall som ser ut til √• f√∏lge en
[Fibonacci f√∏lge](https://en.wikipedia.org/wiki/Fibonacci_number). Aller sist ser det ut til at den siste datoen de har brukt
er 2019-12-11.

Vi har n√• alt vi trenger for √• finne flagget. Vi kaller getSecretPasswordNumber med tallet 34, slik at vi f√•r `password = passord-61`
S√• kaller vi decrypt med passordet, saltet og det krypterte flagget. Voila!
~~~
https://api.spst.no//eval?eval=`<pre>${decrypt('passord-61','NaHSO4',getFlag())}</pre>`
~~~

Flagg: PST{24e592de8b20fe09938916d79b08854e}
{:.note}


~~~js
// file: "code.js"
function getFlag() {
  // Det er sikkert smartere √• kryptere flagget f√∏rst, og bare skrive inn det
  // krypterte resultatet her, enn √• kryptere p√• serveren hver gang.
  // 11.12.19: Kryptert flagget n√•. Vi kan sikkert slette encrypt-funksjonen?
  return "e5a8aadb885cd0db6c98140745daa3acf2d06edc17b08f1aff6daaca93017db9dc8d7ce7579214a92ca103129d0efcdd";
}
function encrypt(input) {
  // Bruk `decrypt` for √• dekryptere

  const algorithm = "aes-192-cbc";
  // 06.12.19: husk √• oppdatere denne hver dag!!!
  // 09.12.19: dette var sykt slitsomt. kan vi finne en bedre l√∏sning?
  // 11.12.19: Krypteres permanent med dagens passord n√•.
  // Denne funksjonen trengs vel ikke lenger?
  const password = getPassword("10.12.19");

  // 09.12.19: pepper er ikke et salt. N√•r vi p√• sikt krypterer utenfor serveren
  // burde vi oppdatere dette til noe mer vitenskapelig korrekt.
  // Natriumhydrogensulfat?
  // 11.12.19: Oppdatert med den kjemiske formelen ;)
  const key = crypto.scryptSync(password, formatSalt("pepper"), 24);

  const iv = Buffer.alloc(16, 0);
  const cipher = crypto.createCipheriv(algorithm, key, iv);
  
  let encrypted = cipher.update(input, "utf8", "hex");
  encrypted += cipher.final("hex");

  return encrypted;
}
function getPassword(date) {
  const passwords = {
    "06.12.19": "passord-" + getSecretPasswordNumber(3),
    "07.12.19": "passord-" + getSecretPasswordNumber(5),
    "08.12.19": "passord-" + getSecretPasswordNumber(8),
    "09.12.19": "passord-" + getSecretPasswordNumber(13),
    "10.12.19": "passord-" + getSecretPasswordNumber(21)
  };
  // 06.12.19: vi har ikke flere passord etter 10. Burde vurdere alternative
  // l√∏sninger.
  return passwords[date] || `fant ikke passord for ${date}`;
}
function decrypt(password, salt, input) {
  const algorithm = "aes-192-cbc";
  
  const key = crypto.scryptSync(password, formatSalt(salt), 24);
  
  const iv = Buffer.alloc(16, 0);
  const decipher = crypto.createDecipheriv(algorithm, key, iv);
  
  let decrypted = decipher.update(input, 'hex','utf8');
  decrypted += decipher.final('utf8');
  
  return decrypted;
}
function getSecretPasswordNumber(n) {
  return Math.PI.toFixed(48).toString().split(".")[1].slice(n, n+2);
}
~~~

## Luke 13 - Token effort (5)
    N√∏kkel p√• avveie
    NPST sin driftsansvarlig er dessverre sykemeldt, og jobben hans er midlertidig overtatt av en alv 
    ved pakkeavdelingen til NISSENS verksted. Pakkealven har lagt merke til noe muffens som foreg√•r p√• Jule NISSENS 
    liste over snille og slemme barn. Pakkealven, som ikke er veldig teknisk anlagt, 
    har behov for hjelp til √• finne ut av hvem som snoker i sakene. Han har ikke s√• mange spor √• gi, 
    men han har pakket ned bevismaterialet godt for √• unng√• bevisforspillelse.

    Alvebetjenten som overbrakte informasjonspakken til Jule NISSEN har dessverre glemt passordet som ble benyttet. 
    Hans sm√• gr√• begynner dessverre √• g√• ut p√• dato, men han mente at passordet var nevnt som en av teknologiene 
    i annonsen fra v√•r samarbeidende tjeneste, PST.

    FILER:
    https://kalender.npst.no/logger.7z.001
    https://kalender.npst.no/logger.7z.002
    https://kalender.npst.no/logger.7z.003
    https://kalender.npst.no/logger.7z.004

    Kan en alvebetjent finne ut av hvilken API-n√∏kkel som er kompromittert, og legge det inn i intranettet p√• 
    formen PST{<den-kompromitterte-n√∏kkelen>}?

    Unng√• lekkasje
    NISSEN vil ogs√• oppfordre alle ansatte til √• beskytte informasjon bedre ved bruk av kryptering. 
    S√∏rg ogs√• for √• bruke gode passord.
    
min kode for denne oppgave er p√• en annen maskin, derfor har jeg ikke inkludert koden jeg faktisk brukte p√• denne.
{:.note}

Aller f√∏rst m√• vi finne n√∏kkelen for √• dekryptere [7zip](https://www.7-zip.org/) arkivet. 
Her hintes det til en teknologi som er nevnt i en finn annonse for PST.
For √• gj√∏re det enkelt for meg bruker jeg [cewl](https://github.com/digininja/CeWL/) for √• lage en ordliste basert p√• finn annonsen.
S√• bruker jeg [7zip-JTR Decrypt Script](https://gist.github.com/bcoles/421cc413d07cd9ba7855), 
og finner passordet `Graylog`. (Of course, misset hintet "sm√• gr√•").
Arkivet inneholder enda en zip fil, som er enda en zip-fil osv. Uten et hint fra Roy Solberg om √• passe p√• √• f√• 
pakket ut absolutt alle loggfiler, hadde jeg nok ikke l√∏st denne (jeg manglet den viktigste).
Ved slike oppgaver s√• er det IKKE lurt √• gj√∏re dette manuelt. S√• n√•r jeg til slutt f√•r laget meg et lite
bash script som rekursivt pakker ut alt som pakkes ut kan, ender vi opp med fem loggfiler.
Analysering av tokens viser at det er 1000 unike tokens som brukes. Det er ikke noe m√∏nster p√• user agents, ei heller noe
access-pattern m√∏nster, IP adressene er interne, s√• man kan ikke se om en av de kommer fra sydpolen f.eks.
ved √• hente ut alle tokens for en dag, og lagre de i en liste, og s√• kj√∏re EXCEPT/minus for alle dager i alle kombinasjoner,
s√• kan man se at det er en dag som peker seg ut med at det er et extra token den dagen. Dette viste seg √•
v√¶re Pen Gwyn (pingvinj√¶vel) igjen.  

Flagg: PST{67e49727affdee991ec58180ee657b28}
{:.note}
## Luke 14 - Lekket data (5)
    Ukens ansatt
    Jule NISSEN gratulerer joey som ukens ansatt, og takker for at han har skapt et fantastisk arbeidsmilj√∏ 
    tross den korte tiden han har jobbet med oss. NISSENS sekretariat vil ta kontakt via elektronisk post f√∏rstkommende virkedag. 
    NISSEN h√•per g√•rsdagens pr√∏velser gikk bra.

    Lekkasje fra SPST
    NPST har gjennom en temmelig hemmelig kilde f√•tt tilsendt et dokument som stammer fra SPST sitt interne nettverk. 
    Kilden sier at filen kommer fra en harddisk som ikke ble makulert da datamaskinen ble kastet. 
    Harddisken var markert med U+2295/U+22BB. Utover dette har vi ingen andre spor om krypteringen som er brukt. 
    Kan en alvebetjent se om det finnes noen mulighet for √• hente ut dataen her?
    
    Det krypterte dokumentet f√∏lger etter en viktig beskjed om julebordet!
    
    Julebord
    
    Det n√¶rmer seg julebord for v√•re alvebetjenter! Det blir konkurranse i hammerkasting 
    og lengste hammerdistanse vil vinne en premie! Juleskinke vil ogs√• bli servert etter en forrett av julegr√∏t. 
    Mandel er s√• klart inkludert!
    
    Melding GSU/MWR0QXpUW1p7TGZvITUXJgQaHiUbCRdONxcgEQwAahgDEU4LIgcxYyclGEwODysBPw8MVCcUAgILZRoxF0kdaiY8NjplGjUXSRKvARh‚èé
    FAyAWdBYME2oGiUUGJAB0NjknHlUKChwgBjURHVQlBQkXDzYYOwsMBmoFiUUgKgAwFQYYKwcfDgtlBjEXGx0+Gh4MGyhSPUUNESRVHwwdMRd0EQAQLx‚èé
    tCRTsrFjEXSRKyGQsAHGUXOkUGBDoGGQgDIAA9Cw5UKwNMAQc2ATFFBgQvBw0WBCocMQsMWkA5CQELNxc6RQgCajs8NjppUh4QBRFqOwUWHSAceEUBE‚èé
    TgQGBELN1I7CB0VJgFMFgEoUh8pKCEZVQQEHGUEshcdVCUXBgAFMVIyChtULBkJFwtlEyJFDR05BglFATUXJgQaHiUbCQsLa3heSEkgIwcfAQ8iUmRW‚èé
    R0V4W11cTi4eNRcdEWoDiRcLZRYtDh0dLRBMDQ8mGTEXDFSvVQgABTcLJBEMBi9VlAsdLhc4DBoALwdMFgEoUiIEG1Q5EAIBGmUGPQlJPwY0OTZAZSQ‚èé
    9RQMbKBcJF04jHSYRGhU+AUwNDzcWIEUEES5ViUUPKxM4HBoROBBMDAArGjsJDRE+VQVFCiwBJwBJjCQGBwACLAEgAAcRZH9BRSErATAEDlR6QUJUXG‚èé
    tDbUUPGzgQGAoFZRc6RQgTLxsYRQsxUiIABRgzHgcAGmUBJAQHHSQSHwoeNRYmBA5UJxoYRSUJMwE2RVQmEAgAHCAcdAQfVAQlPzFAZTkYJDwnagMNF‚èé
    04wBjFFGZFqHwMCCSAGIRdJACMZTBUBNgY/CgcAJQcJEU4oFzBFDBpqFBpFBiQcJ0UbESMbHwEXN1x0IB0ALwdMBAIxUrFFDYwnGAlFHaBSNgAHDT4B‚èé
    CRZONR0nEQIbJAEDFwsxUjIKG1SvVR8AACEXdJ0HByEQAAwdMRcmRQ8GK1VOFgAsHjgAS1QoFB4LQGU2MRFJAiMHBwAcZQE7CEkbJ1UiNT0RUj0OAhF‚èé
    qHQ0XTisdMQtJFSQQABYLZR05RQgAahEJERogUjIKGxEtkB5FHqBSMAAbETlVGAAcNxsgChsdL1tmSE4DADEBCBNqRVpLX3dcZVxJB69VHw4HIwYxEU‚èé
    k6GiY4RRosHnQAB1QkDEwOHDwCIAAbHSQSHwQCIh0mDB0ZL1UfCgNlFT4KGxAvVQ0RTjMbdAwCHy9VAAAAIhcmRQ+ROFUYDAIiEzoCSQAjGUwMACsaO‚èé
    wkNET5VBUWWKwE/AAUdOQEJCwtrUgKAGxFqHQ0GBSAAMUUDGygXCRdONZd0FhkGLxsLRQgqAHSASRIjGwIATiAcdBMMHWoHGQsKMVIwAAcaL1UCHAtl‚èé
    GSYcGQAvBwULCSAcem9EVAaNHgEPIlJkUkdFeFtdXE4sHDIMBQA4EB4RC2UXOkUIEy8bGEUlCTMBNkkHIwEYRRggAD8WHREuVQMCTjcdIAAdVCwaHkW‚èé
    LZQE1BwYALwcJRQQwHjEDBgYoEB4ACiAeJwAHEWZVAQAAZQQxFwIHPhAIABplBDUXSRUmGQkXCyEXdBMMGC4cC0UcKgYxEQxaajMDFwagAjELHRgjEh‚èé
    oMHWUUOxcaHSQeCRdOIRcgEQxULBoeBws3FzAABQcvGwlFACoZdBEAGGoUGEUMIBQ7CQIaIxsLAABlEDgMG1Q/BgUOBSAAdBWMVCUYTAELMVI2CQAGa‚èé
    hACRQkqFnQPHBhkf0FFOiwAJwEIE2pEXEtfd1xlXEkYLwMJFxogUjELSRUtEAIRTiAGdBUIBj4cTA8bKRc2FxwHagEFCU4gHHQVBgAvGx8MCykedA4A‚èé
    GC4QTAxOCyIHMUdUDhAYEQtlEDgASRMgGh4RTiAGIAAbVCsBTBOLN1IgDA0YIxIJFwtlGT0JDRFqBYlFByscJwwNESRVCgwFLlInFQgGIRACRQsxBjE‚èé
    XSRU+VQQEAGUQOABJGzoFCAQJIAZ6RT8dahAeRRs2Gz8XDFQ6kEwKA2UBOZ0bHSQSHwMBNwGsDgwAah0NF04jBzoCDAY+VQkRGiAAJwoEVCsZGgAAZQ‚èé
    ExF0kBPlUYDAJll3QNCFQnEAABGmUWMREdEWocAhELNxwgS2NZaiEDFx0hEzNFWEZkRF5LX3xSJwsIBDoQGEUYLFI7FRlULxtMCAspFj0LDlQlGEwEG‚èé
    mU5GCQ8J2odDRdOJx49ER1UOQwHS04DHSYNjAQvGxgJByIEPRZJAiMZTAELMQYxRQsRPgxMBBplBDEXAgc+EAgAGmUGPQlJPwY0OTZOLRMiCwwGahAC‚èé
    AQ9lHjELDgYvVQ4EBWUCsUUPGzgXCRcLIRc4FgwaL1UfDAAgUiAMBVQgAABLZE94EAQdFSsbCxcLNVI5Ch1UGSU/MWQWBjsXDRU+FAEEHS4bOgAHVDy‚èé
    QHkUGJAB0BwUdPgFMEBo2EyARSRIlB0wAGmUWNREIFSQSHgAeZRt0CwgAPlUfCgNlATEXSQE+VRgMAmWXdBYdFScYCUUINxN0AAdULQcZFR4gUjIXAA‚èé
    IjGQAMCSBSJwoEVCAaDgcLN1IyChtUBCU/MUBlJD1FCxE4VQ0JAiBSNQsaFT4BCUUbKxwzgEmRahcJCxcxBjFFGhEtVQ0TTjEYMQsMBz4QAgBOIwA1R‚èé
    RoAJQcIBBokHzUWAh0kEAJFCDcXOUUdHSZVDQEDLBw9Fh0GKwYGCgA2BjEEBBE+VQQEHGUUsREdVDkcBxcLMVI4nRoaIxsLAABreF5vPB8vGx9FDysB‚èé
    NREdfhoQAkUpMgs6RQ8bOFUZEQMgAD8AHVQ/GwgAHCYdIgAbVCsHDgAHIVI5Ch1UBCU/MUBPeF4xCB8hVRgMAmUTOAkMVCwaHkUbMR8xFwIRPlUNFww‚èé
    gGzBFDREkVR8MHTEXdBEAEC8bQm89LxcyRTokGSFARSUgGycAGwQjGwsTBysXOm9jOghPZi4PKwY9CwwaagMFCU4zlCYASQc+EAICGmUWMUUHETkBCU‚èé
    UaKlIwBA4RJBBMABoxFyZFAhgrEgkXTjWXdAGMBiYcC0UFMxM4DB0RPlUcgE4jGycODBpkVToMTikXIAAbVC8BGAAcZRc6RQcNahkJEws3EzoBkQZqB‚èé
    gMITi4TOkUFETwQHgBOJxcwFwxUOJAaBBwgAHpvOSceDg1WV3dLYlVdRntMXVZfc0dlXF5MfkAKVlonFGEBWBVyCA==
    
Ah, denne oppgaven er g√∏y. Noe er kryptert, og vi har f√•tt et hint `U+2295/U+22BB`. Disse er unicode karakterer ‚äï/‚äª,
som er symboler brukt for [XOR](https://en.wikipedia.org/wiki/Exclusive_or). S√• det er h√∏yst sannsynlig en XOR encryption
som er brukt med en n√∏kkel av noe slag. 
Jeg husker ikke helt hvordan jeg faktisk kom fram til l√∏sningen her, jeg jobbet en del med bruteforcing og s√∏k etter 
korrekt lengde p√• n√∏kkel. Uansett, [xortool](https://github.com/hellman/xortool) er ganske fantastisk for √• knekke xor encryption.
Aller f√∏rst m√• vi hente ut de faktiske bytes (strengen er base 64 encoded).
Lagre strengen som en tekstfil `melding.b64`, deretter converter til bytes i bash.
Ser ut til at vi har f√•tt en delvis match, teksten var ikke helt korrekt. enkelt √• gjette seg fram til den korrekte 
n√∏kkelen `JulenErTeit`, og vi finner flagget.
[Cyberchef oppskrift](https://gchq.github.io/CyberChef/#recipe=From_Base64('A-Za-z0-9%2B/%3D',false)XOR(%7B'option':'UTF8','string':'JulenErTeit'%7D,'Standard',false)&input=R1NVL01XUjBRWHBVVzFwN1RHWnZJVFVYSmdRYUhpVWJDUmRPTnhjZ0VRd0FhaGdERVU0TElnY3hZeWNsR0V3T0R5c0JQdzhNVkNjVUFnSUxaUm94RjBrZGFpWThOanBsR2pVWFNSS3ZBUmhGQXlBV2RCWU1FMm9HaVVVR0pBQjBOamtuSGxVS0Nod2dCalVSSFZRbEJRa1hEellZT3dzTUJtb0ZpVVVnS2dBd0ZRWVlLd2NmRGd0bEJqRVhHeDArR2g0TUd5aFNQVVVORVNSVkh3d2RNUmQwRVFBUUx4dENSVHNyRmpFWFNSS3lHUXNBSEdVWE9rVUdCRG9HR1FnRElBQTlDdzVVS3dOTUFRYzJBVEZGQmdRdkJ3MFdCQ29jTVFzTVdrQTVDUUVMTnhjNlJRZ0NhanM4TmpwcFVoNFFCUkZxT3dVV0hTQWNlRVVCRVRnUUdCRUxOMUk3Q0IwVkpnRk1GZ0VvVWg4cEtDRVpWUVFFSEdVRXNoY2RWQ1VYQmdBRk1WSXlDaHRVTEJrSkZ3dGxFeUpGRFIwNUJnbEZBVFVYSmdRYUhpVWJDUXNMYTNoZVNFa2dJd2NmQVE4aVVtUldSMFY0VzExY1RpNGVOUmNkRVdvRGlSY0xaUll0RGgwZExSQk1EUThtR1RFWERGU3ZWUWdBQlRjTEpCRU1CaTlWbEFzZExoYzREQm9BTHdkTUZnRW9VaUlFRzFRNUVBSUJHbVVHUFFsSlB3WTBPVFpBWlNROVJRTWJLQmNKRjA0akhTWVJHaFUrQVV3TkR6Y1dJRVVFRVM1VmlVVVBLeE00SEJvUk9CQk1EQUFyR2pzSkRSRStWUVZGQ2l3Qkp3QkpqQ1FHQndBQ0xBRWdBQWNSWkg5QlJTRXJBVEFFRGxSNlFVSlVYR3REYlVVUEd6Z1FHQW9GWlJjNlJRZ1RMeHNZUlFzeFVpSUFCUmd6SGdjQUdtVUJKQVFISFNRU0h3b2VOUlltQkE1VUp4b1lSU1VKTXdFMlJWUW1FQWdBSENBY2RBUWZWQVFsUHpGQVpUa1lKRHduYWdNTkYwNHdCakZGR1pGcUh3TUNDU0FHSVJkSkFDTVpUQlVCTmdZL0NnY0FKUWNKRVU0b0Z6QkZEQnBxRkJwRkJpUWNKMFViRVNNYkh3RVhOMXgwSUIwQUx3ZE1CQUl4VXJGRkRZd25HQWxGSGFCU05nQUhEVDRCQ1JaT05SMG5FUUliSkFFREZ3c3hVaklLRzFTdlZSOEFBQ0VYZEowSEJ5RVFBQXdkTVJjbVJROEdLMVZPRmdBc0hqZ0FTMVFvRkI0TFFHVTJNUkZKQWlNSEJ3QWNaUUU3Q0VrYkoxVWlOVDBSVWowT0FoRnFIUTBYVGlzZE1RdEpGU1FRQUJZTFpSMDVSUWdBYWhFSkVSb2dVaklLR3hFdGtCNUZIcUJTTUFBYkVUbFZHQUFjTnhzZ0Noc2RMMXRtU0U0REFERUJDQk5xUlZwTFgzZGNaVnhKQjY5Vkh3NEhJd1l4RVVrNkdpWTRSUm9zSG5RQUIxUWtERXdPSER3Q0lBQWJIU1FTSHdRQ0loMG1EQjBaTDFVZkNnTmxGVDRLR3hBdlZRMFJUak1iZEF3Q0h5OVZBQUFBSWhjbVJRK1JPRlVZREFJaUV6b0NTUUFqR1V3TUFDc2FPd2tORVQ1VkJVV1dLd0UvQUFVZE9RRUpDd3RyVWdLQUd4RnFIUTBHQlNBQU1VVURHeWdYQ1JkT05aZDBGaGtHTHhzTFJRZ3FBSFNBU1JJakd3SUFUaUFjZEJNTUhXb0hHUXNLTVZJd0FBY2FMMVVDSEF0bEdTWWNHUUF2QndVTENTQWNlbTlFVkFhTkhnRVBJbEprVWtkRmVGdGRYRTRzSERJTUJRQTRFQjRSQzJVWE9rVUlFeThiR0VVbENUTUJOa2tISXdFWVJSZ2dBRDhXSFJFdVZRTUNUamNkSUFBZFZDd2FIa1dMWlFFMUJ3WUFMd2NKUlFRd0hqRURCZ1lvRUI0QUNpQWVKd0FIRVdaVkFRQUFaUVF4RndJSFBoQUlBQnBsQkRVWFNSVW1HUWtYQ3lFWGRCTU1HQzRjQzBVY0tnWXhFUXhhYWpNREZ3YWdBakVMSFJnakVob01IV1VVT3hjYUhTUWVDUmRPSVJjZ0VReFVMQm9lQndzM0Z6QUFCUWN2R3dsRkFDb1pkQkVBR0dvVUdFVU1JQlE3Q1FJYUl4c0xBQUJsRURnTUcxUS9CZ1VPQlNBQWRCV01WQ1VZVEFFTE1WSTJDUUFHYWhBQ1JRa3FGblFQSEJoa2YwRkZPaXdBSndFSUUycEVYRXRmZDF4bFhFa1lMd01KRnhvZ1VqRUxTUlV0RUFJUlRpQUdkQlVJQmo0Y1RBOGJLUmMyRnh3SGFnRUZDVTRnSEhRVkJnQXZHeDhNQ3lrZWRBNEFHQzRRVEF4T0N5SUhNVWRVRGhBWUVRdGxFRGdBU1JNZ0doNFJUaUFHSUFBYlZDc0JUQk9MTjFJZ0RBMFlJeElKRnd0bEdUMEpEUkZxQllsRkJ5c2NKd3dORVNSVkNnd0ZMbEluRlFnR0lSQUNSUXN4QmpFWFNSVStWUVFFQUdVUU9BQkpHem9GQ0FRSklBWjZSVDhkYWhBZVJSczJHejhYREZRNmtFd0tBMlVCT1owYkhTUVNId01CTndHc0Rnd0FhaDBORjA0akJ6b0NEQVkrVlFrUkdpQUFKd29FVkNzWkdnQUFaUUV4RjBrQlBsVVlEQUpsbDNRTkNGUW5FQUFCR21VV01SRWRFV29jQWhFTE54d2dTMk5aYWlFREZ4MGhFek5GV0Vaa1JGNUxYM3hTSndzSUJEb1FHRVVZTEZJN0ZSbFVMeHRNQ0FzcEZqMExEbFFsR0V3RUdtVTVHQ1E4SjJvZERSZE9KeDQ5RVIxVU9Rd0hTMDRESFNZTmpBUXZHeGdKQnlJRVBSWkpBaU1aVEFFTE1RWXhSUXNSUGd4TUJCcGxCREVYQWdjK0VBZ0FHbVVHUFFsSlB3WTBPVFpPTFJNaUN3d0dhaEFDQVE5bEhqRUxEZ1l2VlE0RUJXVUNzVVVQR3pnWENSY0xJUmM0Rmd3YUwxVWZEQUFnVWlBTUJWUWdBQUJMWkU5NEVBUWRGU3NiQ3hjTE5WSTVDaDFVR1NVL01XUVdCanNYRFJVK0ZBRUVIUzRiT2dBSFZEeVFIa1VHSkFCMEJ3VWRQZ0ZNRUJvMkV5QVJTUklsQjB3QUdtVVdOUkVJRlNRU0hnQWVaUnQwQ3dnQVBsVWZDZ05sQVRFWFNRRStWUmdNQW1XWGRCWWRGU2NZQ1VVSU54TjBBQWRVTFFjWkZSNGdVaklYQUFJakdRQU1DU0JTSndvRVZDQWFEZ2NMTjFJeUNodFVCQ1UvTVVCbEpEMUZDeEU0VlEwSkFpQlNOUXNhRlQ0QkNVVWJLeHd6Z0VtUmFoY0pDeGN4QmpGRkdoRXRWUTBUVGpFWU1Rc01CejRRQWdCT0l3QTFSUm9BSlFjSUJCb2tIelVXQWgwa0VBSkZDRGNYT1VVZEhTWlZEUUVETEJ3OUZoMEdLd1lHQ2dBMkJqRUVCQkUrVlFRRUhHVVVzUkVkVkRrY0J4Y0xNVkk0blJvYUl4c0xBQUJyZUY1dlBCOHZHeDlGRHlzQk5SRWRmaG9RQWtVcE1nczZSUThiT0ZVWkVRTWdBRDhBSFZRL0d3Z0FIQ1lkSWdBYlZDc0hEZ0FISVZJNUNoMVVCQ1UvTVVCUGVGNHhDQjhoVlJnTUFtVVRPQWtNVkN3YUhrVWJNUjh4RndJUlBsVU5Gd3dnR3pCRkRSRWtWUjhNSFRFWGRCRUFFQzhiUW04OUx4Y3lSVG9rR1NGQVJTVWdHeWNBR3dRakd3c1RCeXNYT205ak9naFBaaTRQS3dZOUN3d2FhZ01GQ1U0emxDWUFTUWMrRUFJQ0dtVVdNVVVIRVRrQkNVVWFLbEl3QkE0UkpCQk1BQm94RnlaRkFoZ3JFZ2tYVGpXWGRBR01CaVljQzBVRk14TTREQjBSUGxVY2dFNGpHeWNPREJwa1ZUb01UaWtYSUFBYlZDOEJHQUFjWlJjNlJRY05haGtKRXdzM0V6b0JrUVpxQmdNSVRpNFRPa1VGRVR3UUhnQk9KeGN3Rnd4VU9KQWFCQndnQUhwdk9TY2VEZzFXVjNkTFlsVmRSbnRNWFZaZmMwZGxYRjVNZmtBS1Zsb25GR0VCV0JWeUNBPT0)  

Flagg: PST{a392960421913165197845f34bf5d1a8}
{:.note}
Kode:
~~~bash
$ cat melding.b64 | base64 -d > melding.bin
$ xortool melding.bin
The most probable key lengths:
   1:   10.6%
   5:   9.6%
   9:   8.8%
  11:   24.4%
  18:   5.8%
  22:   14.4%
  25:   4.6%
  33:   9.7%
  44:   6.9%
  55:   5.4%
Key-length can be 3*n
Key-length can be 4*n
Most possible char is needed to guess the key!
$ xortool -l 11 -c 20 melding.bin
1 possible key(s) of length 11:
'Ju)enEr\x11eit
Found 1 plaintexts with 95%+ valid characters
See files filename-key.csv, filename-char_used-perc_valid.csv
~~~

## Luke 15 
### 15. desember (10)
    Beslag av minnepenn
    NPST har i all hemmelighet tatt beslag i en minnepenn som tilh√∏rer en sydpolarsk akt√∏r ved navn Pen Gwyn. 
    Minnepennen ser i f√∏rste √∏yekast ut til √• v√¶re privat og inneholde feriebilder, 
    men det er ogs√• en kryptert zip fil lagret p√• den. 
    NPST trenger tilgang til denne zip filen og s√∏ker umiddelbar hjelp 
    fra alvebetjentene for √• finne passordet. Merk: Passordet √∏nskes innlevert i klartekst p√• intranettet!
    
    Eksempel: Hunter2 -> PST{Hunter2}
    
    Jule NISSENS sykdomsforl√∏p
    Jule NISSEN ser ut til √• v√¶re p√• bedringens vei allerede 
    og han vil mest sannsynlig v√¶re tilbake p√• jobb i god tid f√∏r jul.
    
    Julevurdering
    Med bakgrunn i endringen av Jule NISSENS sykdom blir julevurderingen oppgradert. 
    Det er n√• sannsynlig at det blir en GOD JUL.
    
Ooo. En minnepinne. Ok, la oss se hva vi har √• jobbe med.
~~~bash
$ file spst_minnepinne.dd
spst_minnepinne.dd: DOS/MBR boot sector MS-MBR Windows 7 english at offset 0x163 
"Invalid partition table" at offset 0x17b 
"Error loading operating system" at offset 0x19a 
"Missing operating system", disk signature 0x75be3a56; 
partition 1 : ID=0x7, start-CHS (0x0,32,33), end-CHS (0x82,170,40), startsector 2048, 2097152 sectors
~~~
Hmm, vel kanskje vi bare skal mounte den for √• se hva den inneholder?
~~~bash
$ losetup --partscan --find --show spst_minnepinne.dd
/dev/loop0
$ cd /media/root/SPST/
$ ls -al
total 5552
drwxrwxrwx  1 root root    4096 Nov 29 16:22  .
drwxr-x---+ 3 root root    4096 Jan  5 15:58  ..
-rwxrwxrwx  1 root root 5676023 Nov 29 16:22  feriebilder.zip
drwxrwxrwx  1 root root       0 Nov 29 16:21 'System Volume Information'
$ cd System\ Volume\ Information/
$ ls -al
total 5
drwxrwxrwx 1 root root    0 Nov 29 16:21 .
drwxrwxrwx 1 root root 4096 Nov 29 16:22 ..
-rwxrwxrwx 1 root root   76 Nov 29 16:21 IndexerVolumeGuid
-rwxrwxrwx 1 root root   12 Nov 29 16:21 WPSettings.dat
$ cat IndexerVolumeGuid 
{6BA8F788-A856-4200-A576-2F97CDF4A269}
$ cat WPSettings.dat 

. 
~~~
S√•, der har vi feriebildene, og de er passordbeskyttet. Det er alt som vises p√• disken, ikke no g√∏y i andre filer. 
Da m√• passordet v√¶re skjult en plass, vi pr√∏ver med en `strings` p√• dd filen, og der kommer faktisk et password ut di gitt, base 64 encoded. 
"Et kjempelangt passord som aldri vil kunne gjettes av NPST! :)"  

Flagg: PST{Et kjempelangt passord som aldri vil kunne gjettes av NPST! :)}
{:.note}

Ett av bildene har nok en gul lapp med informasjon `VII TW ‚öôÔ∏è`.
### Alternativer (15)
    NPST har mottatt informasjon om at minnepennen var tiltenkt en nordpolar kilde f√∏rt av en sydpolar kildef√∏rer. 
    Kilden og kildef√∏reren skal ikke ha noe direkte kjennskap til hverandre, 
    men kommuniserer p√• en forh√•ndsavtalt m√•te. 
    V√•re alveteknikere trenger en innf√∏ring i hvordan de skjuler dataen sin. Kan du hjelpe dem?
    
    Flagget er PST{md5(navnet p√• stedet du fant passordet i forrige trinn (ett tegn))}
    
    eks: echo -ne "?" | md5sum d1457b72c3fb323a2671125aef3eab5d -
    
    Flagget blir da PST{d1457b72c3fb323a2671125aef3eab5d}

Hrmph. S√• vi trenger √• finne ut hvordan de lagrer informasjonen. Ok, opp med "the big gun", [Sleuth kit - Autopsy](https://www.sleuthkit.org/autopsy/).
litt snusing rundt der eksponerer informasjonen er lagret i en `_`. Dette er en feature man finner i NTFS - [Alternate Data Streams](https://blogs.technet.microsoft.com/askcore/2013/03/24/alternate-data-streams-in-ntfs/).
![Autopsy sleuthkit](/assets/img/blog/2020-npst/15-autopsy.png)
F√∏lger vi oppskriften over f√•r vi flagget. 
~~~bash
echo -ne "_" | md5sum
b14a7b8059d9c055954c92674ce60032
~~~

Flagg: PST{b14a7b8059d9c055954c92674ce60032}
{:.note}
### Feriebilder (20)
    Bildene ser jo ut til √• v√¶re helt normale sydpolare feriebilder, 
    men vi vet jo at sydpolare spioner liker √• gjemme data inni andre ting. 
    Kan du hente ut et flagg fra ett av bildene?

![PST{md5(red_herring)}](/assets/img/blog/2020-npst/15_Blue_0.png)
Dette m√• jo bare v√¶re en stego oppgave, og jeg hadde rett. Ved √• bruke [stegoveritas](https://github.com/bannsec/stegoVeritas) p√• 
`varm dag p√• stranda.png`, s√• dukker det opp informasjon i [LSB](https://itnext.io/steganography-101-lsb-introduction-with-python-4c4803e08041) i Bl√• og Gr√∏nn kanalen.
PST{md5(red_herring)}. Noe mer informasjon klarer jeg ikke √• finne, men det ser jo ut til at kan spiser fisk p√• ett av bildene, 
vedder p√• at det er en red herring. R√∏d er den iallefall, og md5 av filen er det korrekte flagget.

~~~bash
$ md5sum m√•ltid.png 
07385aacc9264738cd7c32e76f3b81a5  m√•ltid.png
~~~

Flagg: PST{07385aacc9264738cd7c32e76f3b81a5}
{:.note}
## Luke 16
    Opptrapping av fremmed rekruttering
    SPST har trappet opp sine fors√∏k p√• √• rekruttere informanter i b√•de NPST og i den nordpolare alvebefolkningen. 
    NPST ber derfor alle alvebetjenter om √• v√¶re oppmerksomme p√• tegn 
    p√• at de eller andre blir utsatt for p√•virkningsoperasjoner. 
    Slike tegn kan for eksempel v√¶re at partier med pepperkaker eller julebrus blir levert til din adresse. 
    Dersom du opplever situasjoner der du mistenker at deg selv eller andre blir fors√∏kt rekruttert, 
    ta kontakt med din lokale sikkerhetsavdeling.
    
    Vi ber ogs√• alvebetjenter om √• v√¶re forsiktige med √• dele intern informasjon. 
    Selv om informasjonen ikke n√∏dvendigvis er gradert temmelig hemmelig 
    s√• kan den gi et innblikk i hvordan NPST jobber. 
    Dette kan gj√∏re fremmede makters p√•virkningskampanjer mer effektive, 
    og √∏ke sjansene for velykket sabotasje mot nordpolare interesser. 
    V√¶r derfor ekstra p√•passelig n√•r du snakker med andre om arbeidet ditt i NPST 
    og s√∏rg for at du ikke deler informasjon un√∏dig. 
    Husk ogs√• at fremmede makter kan fors√∏ke √• overh√∏re samtaler, 
    s√• v√¶r forsiktig dersom du observerer pingviner i omr√•det.
    
    Du snakker. Hvem lytter?
    
    Falske nyheter og julevurdering
    En artikkel om at julen er avlyst har spredd seg p√• sosiale medier. Med bakgrunn i disse falske nyhetene 
    nedjusteres sannsynligheten for at det blir en god jul. Det er n√• mulig at det blir en GOD JUL.
    
Ingen oppgaver denne dagen.

## Luke 17 - Passorddatabase (5)
    Passorddatabase
    I tr√•d med Jule NISSENS anmodninger om at en b√∏r beskytte informasjon bedre har alvene i kantinen tatt i bruk 
    en hjemmesnekret passorddatabase. Problemet er bare at de dessverre har glemt passordet til denne. 
    Det er kritisk at kantinealvene f√•r tilgang til passordet som er lagret i denne databasen s√• fort som mulig, 
    ellers s√• vil de ikke kunne √•pne matlageret og lage julegr√∏t til i morgen! 
    Kan en alvebetjent ta p√• seg oppgaven med √• finne passordet til matlageret?
    
    FIL: https://kalender.npst.no/p2w
    
    Oppdatering av Jule NISSENS sykdomsforl√∏p
    Jule NISSEN er frisk og rask og vil v√¶re tilbake i full jobb i morgen. 
    Det vil forst√•elig nok v√¶re litt tregere behandling av listen over snille og slemme barn mens Jule NISSEN 
    tar igjen det utest√•ende arbeidet. Vi ber om at alle tar hensyn til dette.
    
Hm, hva er dette? la oss se hva vi har √• jobbe med.
~~~bash
file p2w
p2w: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, 
interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 2.6.32, 
BuildID[sha1]=758ae2fdb3384d82e1c697e0977354612bce94bf, not stripped
$ chmod +x p2w
$ ./p2w
Passord: hei
Feil, pigg av!
~~~
Fantastisk. Pigg av igjen. Oh well, la oss ta en titt p√• om den gj√∏r noe g√∏y vha [ltrace](https://en.wikipedia.org/wiki/Ltrace).
√òrrr, tror jeg ser passordet p√• h√∏yresiden av strcmp(), la meg pr√∏ve... yep, it works.
~~~bash
$ ltrace ./p2w
printf("Passord: ")
fgets(Passord: hei 
"hei\n", 33, 0x7fbafec5ea00)
strcmp("hei\n", "625b2055fe2dcda72e418940599b881d"...)
puts("Feil, pigg av!"Feil, pigg av!)
+++ exited (status 0) +++
$ ltrace ./p2w
printf("Passord: ")                
fgets(Passord: 625b2055fe2dcda72e418940599b881d
"625b2055fe2dcda72e418940599b881d"..., 33, 0x7f19021b2a00)
strcmp("625b2055fe2dcda72e418940599b881d"..., "625b2055fe2dcda72e418940599b881d"...)
puts("PST{f3ad88918fd18414cc773271f586"...PST{f3ad88918fd18414cc773271f586f6a9})
+++ exited (status 0) +++

~~~
S√•... der var svaret ja. rimelig enkel begynner reverserings oppgave uten at man har behov for noe tungt ala [IDA](https://www.hex-rays.com/products/ida/), 
[Radare2](https://rada.re/n/radare2.html), [Ghidra](https://ghidra-sre.org/) etc.  

Flagg: PST{f3ad88918fd18414cc773271f586f6a9}
{:.note}

## Luke 18
    Mistenkelig ponni
    En ponni ble oppdaget i reinsdyrstallen i formiddag. 
    Den ble oppdaget i etterkant av sv√¶rt uvanlige lyder blant reinsdyrene. 
    Det er uvisst hvor lenge ponnien har befunnet seg i stallen. 
    Det foretas unders√∏kelser av v√•re fremste teknikere for √• utelukke at det er en trojansk ponni.
    
Ingen oppgaver denne dagen.

## Luke 19 - PPKv3 (5)
    Ny PPK
    I lys av senere tids passordproblematikk har NISSEN utviklet en ny PPK. 
    Kan noen alvebetjenter unders√∏ke om NISSEN har klart √• luke ut alle svakheter fra tidligere designiterasjoner?
    
    Eksempel
    PPKv3("Pomp√∏st og metodisk") ‚Üí √∏MSijrt Mc S√ÖtMZPrU
    
    √∏mQ U√¶jEEi4√¶√Ökt√Ör i4√¶√Ökt√Ör SZG tWM tPS√Ö i4Z i4√¶√Ökt√Ör rE0tt U√¶jEEi4√¶√Ökt√Ör rE0tt

Mere penn og papir kryptering. Med et eksempel. Ser ut til at det er en substitusjon av noe slag, 
la oss ta input fra eksemplet og legge inn det vi har vha substitusjon i [cyberchef](https://gchq.github.io/CyberChef/#recipe=Substitute('ABCDEFGHIJKLMNOPQRSTUVWXYZ%C3%86%C3%98%C3%85abcdefghijklmnopqrstuvwxyz%C3%A6%C3%B8%C3%A5','ABCDEFGHIJKLoNOiQRmTkVWXYd%C3%86%C3%98eabgdefghp%C3%B8klmnopqsstuvwxyz%C3%A6P%C3%A5')&input=%2BE1TaWpydCBNYyBTxXRNWlByVQr4bVEgVeZqRUVpNObFa3TFciBpNObFa3TFciBTWkcgdFdNIHRQU8UgaTRaIGk05sVrdMVyIHJFMHR0IFXmakVFaTTmxWt0xXIgckUwdHQ), for √• se hva vi f√•r.
~~~
Pomp√∏st og metodisk
PmQ k√¶√∏EEp4√¶ektes p4√¶ektes mdG tWo time p4d p4√¶ektes sE0tt k√¶√∏EEp4√¶ektes sE0tt
~~~
Begynner √• ligne p√• noenting, la oss gjekke litt til p√• kr√∏llparentes, PST og slutt
~~~
Pomp√∏st og metodisk
PST kr√∏llparentes parentes mdG tWo time pad parentes slutt kr√∏llparentes slutt
~~~
Litt mere gjetting, s√• tipper jeg det st√•r `PST{(md5 two time pad)}`. parentesene er nok feil, s√• resultatet skal nok v√¶re
`PST{md5(two time pad)}`. Litt banning og sverting, men med et hint fra Roy Solberg gjorde at jeg kom i m√•l her ogs√•. 
(husk p√• -n p√• echo for √• unng√• √• f√• med linjeskift)
~~~bash
echo -n 'two time pad' | md5sum
4a0fc5f3c88874cab11c64e965dff58d  -
~~~

Flagg: PST{4a0fc5f3c88874cab11c64e965dff58d}
{:.note}

## Luke 20 - Mystisk kort (5)
    Mystisk kort
    
    NPST har grunn til √• tro at SPST har noen systemer kj√∏rende p√• meget gammel hardware. 
    Fra temmelig hemmelige kilder har vi greie p√• at SPST har outsourcet utviklingen av disse systemene, 
    og f√•r tilsendt kildekode for oppdateringen og ny funksjonalitet p√• postkort. 
    NPST har nylig snappet opp et slikt kort markert "360", som anntas √• innholde kode av noe slag. 
    Dessverre ser det ut til at teknikerne v√•re har noen hull i programmeringskunnskapene sine, 
    de kommer rett og slett til kort. Kunne en alvebetjent sett p√• kortet?
    
    1020 2020 0010 2012 2001 2200 1020 0000 0800 0200 0001 200A 2001 2200 1020 0C00 0300 0008 0800 1012
    
    Om noen finner ut av det hadde NISSEN satt pris p√• om vedkommende kunne kj√∏rt koden, 
    og lagt outputen de f√•r inn i intranettet omkranset av { og }, samt prefikset med PST. 
    Eksempel: kode: print("Hei, verden!") ‚Üí output: Hei, verden! ‚Üí svar: PST{Hei, verden!}.

Haugevis med hint til gammelt system, kort, hull og 360. S√• her snakker vi gammelt hullkort system. Finner masse
g√∏y informasjon p√• [The virtual keypunch](https://www.masswerk.at/keypunch/), spesielt under "advanced usage",
hvor vi kan finne IBM/360 Column Binary Format. Jeg finner ingen online tools for dette (er jo gammelt),
s√• jeg skriver en dekoder basert p√• informasjonen over og f√•r ut `MD5(IBM 029+IBM/S60)`. Tipper S er feil og at det skal st√•
`MD5(IBM 029+IBM/360)`, som gir oss korrekt flagg.  

Flagg: PST{8dc9112fecac5e5d50eaf14e0fff2440}
{:.note}


~~~python
# file: "solver.py"
input = '1020 2020 0010 2012 2001 2200 1020 0000 0800 0200 0001 200A 2001 2200 1020 0C00 0300 0008 0800 1012'
# split into blocks
blocks = input.split(' ')
result = []


def getCbf(b, res):
    retVal = ''
    for pos in range(0, 7):
        if b & 1 << pos != 0:
            retVal = res[7 - pos] + retVal
    return retVal


def getCbf1(b):
    return getCbf(b, 'JKYX0123')


def getCbf2(b):
    return getCbf(b, 'LM456789')


def getKeyPunch(cbf):
    cbf1 = cbf[0:1]
    if len(cbf) == 3:
        cbf2 = str(int(cbf[1:2]) + int(cbf[2:3]))
    elif len(cbf) == 1:
        return cbf
    else:
        cbf2 = cbf[1:2]
    cY = '&ABCDEFGHI¬¢.<(+|'
    cX = '-JKLMNOPQR!$*);¬¨'
    c0 = '0/STUVWXYZ ,%_>?'
    c1 = '1AJ/'
    c2 = '2BKS:¬¢! '
    c3 = '3CLT#.$,'
    c4 = '4DMU@<*%'
    c5 = '5ENV\'()_'
    c6 = '6FOW=+;>'
    c7 = '7GPX"|¬¨?'
    c8 = '8QY:#@\'="¬¢.<(+|!$*);¬¨ ,%_>?'
    c9 = '9IRZ'
    if cbf1 == '' and cbf2 == '':
        return ' '
    if cbf2 == '':
        return '?'
    if cbf1 == 'X':
        return cX[int(cbf2)]
    if cbf1 == 'Y':
        return cY[int(cbf2)]
    if cbf1 == '0':
        return c0[int(cbf2)]
    if cbf1 == '1':
        return c1[int(cbf2)]
    if cbf1 == '2':
        return c2[int(cbf2)]
    if cbf1 == '3':
        return c3[int(cbf2)]
    if cbf1 == '4':
        return c4[int(cbf2)]
    if cbf1 == '5':
        return c5[int(cbf2)]
    if cbf1 == '6':
        return c6[int(cbf2)]
    if cbf1 == '7':
        return c7[int(cbf2)]
    if cbf1 == '8':
        return c8[int(cbf2)]
    if cbf1 == '9':
        return c9[int(cbf2)]
    return '?'


for block in blocks:
    b1 = int(block[0:2], 16)
    b2 = int(block[2:4], 16)
    c1 = getCbf1(b1)
    c2 = getCbf2(b2)
    cbf = c1 + c2
    kp = getKeyPunch(cbf)
    result.append([block, b1, b2, c1, c2, cbf, kp])

print('hex\tb1\tb2\tc1\tc2\tcbf\tkp')
for line in result:
    print(
        line[0] + '\t' +
        ("0x%0.2X" % line[1]) + '\t' +
        ("0x%0.2X" % line[2]) + '\t' +
        line[3] + '\t' +
        line[4] + '\t' +
        line[5] + '\t' +
        line[6])
for line in result:
    print(line[6], end='')

~~~
## Luke 21 - Nytt kryptosystem (5)
    Ukens ansatt Jule NISSEN gratulerer Karine som ukens ansatt, og takker for god innsats. 
    NISSENS sekretariat vil ta kontakt via elektronisk post s√• fort det lar seg gj√∏re. 
    Beregn noe ekstra tid grunnet julestri.
    
    Nytt kryptosystem
    
    SPST har nylig f√•tt installert et nytt kryptosystem, og vi i NPST har v√¶rt tidlig p√• ballen 
    og f√•tt plassert avlyttingsutstyr p√• linjene over Antarktis.
    
    Det kan se ut som at leverand√∏ren til SPST har noen innkj√∏ringsproblemer, da n√∏kkelen ikke ser ut til √• virke. 
    Klarer du √• finne ut av hva som er galt?
    
    Link til melding
    
    Jule NISSENS sykdomsforl√∏p
    
    Jule NISSEN er frisk og rask, og har v√¶rt p√• jobb innenfor kjernetiden de siste dagene. 
    Han vil for sikkerhets skyld ta det rolig frem til og med lille julaften i p√•vente av den store dagen, 
    og vil p√• grunn av dette sannsynligvis trenge noe ekstra hjelp p√• mandag.
    
    Julevurdering
    
    Ettersom Jule NISSEN er blitt frisk, blir julevurderingen oppgradert. 
    Det er n√• meget sannsynlig at det blir en GOD JUL.

Javel, et nytt kryptosystem. Skal vi se hva vi har √• jobbe med:
~~~json
{
    "cipher": "aes-256-gcm",
    "ciphertext": "69cf99390e143fbab3ea8326c05b2fde58c964555bd673de10ff4cf2bf49586454b0466afd01c36b0e4dc1e3361d8ff‚èé
                  ec8998d88c13b6ff83798a4607b86f3d14f20f63486d256e65d2164ac90a931d7c36fed071321298ce6eb4206bbc31db‚èé
                  dbd08d72dca0f5ce486e68979f083e0e4f46d1f0eee0fec2aa48de030cb2f2069eb719563443c324b052a913e5007f11‚èé
                  4de4ed7ae44044c03278e2392b46e7815626424d735196f93adc446c4a4a30373e936fa7164112d0867e63e63a4d809d‚èé
                  10e90e805130eb7114422ae17fddd3a272cee6100087fb37eb0268ab187721fc7e8dc8b2b79e91a1d9e276a16bcb79c3‚èé
                  6a7c91b127ea3b08fe57a33ba7d0767e35508b4ab2127aa0a2948cd2a1aace305a49cf63d03a41ca110e9d04636a8595‚èé
                  6aa1b9eac89bc4091ab59bd1ea9d9cd1c225422a7a40ef56d4b65d1e56f138df24dcf74557a72ba055160f82bf39470f‚èé
                  785b12633584ae9639a4352ef08fe5c7f788b0f83021ccf13d7a99a0c088abf72ccc36a30e2447ce10157113a56461bf‚èé
                  afd68be40f6f79dbdf2c901028cfe06a96e5ab9a1121c7e2d8b91e495c9722b2cd97d378844328bfba9870b814df6028‚èé
                  2fec98f70d1639d35205d399d0a858a5cf7210cd9110faecc55c79ae7fe963d908aaa8a34d68b4c0556aeaa4db1ec74c‚èé
                  d321b249602c24dabc961b30ae456199fb1deca09f36cdf8a5d9b0b492e42f7f841cb4627880f9fdd4b2e2d94a553c61‚èé
                  c5c9a0a253a4616af93310eb7a55a74316d595c017cd2953e505d893f85f324a50fecd459e6bce60294aef9e34b7d57c‚èé
                  98f4e9dc5e09a9a6fe620865308d807d767e4c9fec6041b58d003b152d18473e8ce5a9bfe5203b748945a8f4c4683177‚èé
                  b09c6b97603d37451a6220c7cf94fa4cb2f8c26331e08f8b8035acebdeaba4cec24bbdacad448b332ba67d355a91363d‚èé
                  13a4030a7f4e5b3e0d12a5cca08d6431e356a1bf5050c9bb6373a375a58909cb59d851c0da4905a62389aef2809e354f‚èé
                  b2d6b672071ded673f50a3ca475b229999d5a8566e3d7742a271c91f97d8182cb6dcbd3811276cea2386e66b10f047f5‚èé
                  cfd0628e3a55ed420412a4fd1b568ef4a62384694dc6b966defe4226afcc545ff10cd61c181d5df9ce6011995df72a21‚èé
                  9f45ac44eccc63450989df746edbc7165ae008caa158c9298e6c8f8907be02c89313ec55be8eef3521a251518e394071‚èé
                  b9deb5af8d2273cf7fe2ed9ddc96609a8057ca50e5a5c1b0a9b9e4dfa04e58be60feee17632dd713257916416471560c‚èé
                  82da72e49962d1bfcda8db174948765bfc51159e98d38cad9a7ba51a7c8658af998534a6b223d25ba4805c4a12bf0807‚èé
                  e043abc0b47e4562a800b6f79fca703bbd93b1c617d3a8b9244ebfcaffd7f8e44440a20ce1ed7ab8039d5cf182c7c16e‚èé
                  7be51856ac8a516ca25acf79001af3612d7b4d304c2a5b9671620b80db4fedca8df2ec6b57ddbcf4fe9ece3da44bf47e‚èé
                  0f3b21b61f0699e6c38a3169b2890f57636757a894caf22879b1515d1aa00ee8131d3cf7b61ab9c747690bd6ef3d93ed‚èé
                  002c1f3a8e9b7a6b056f76cad42d67ae3f01c1d8d4d8576b950efe65b6312b700f2000f8c3821a70ba1e4800b5bdb422‚èé
                  3f9db27c509495eb638025c4dc898c13ae9f86c944e5428209a111701bc4e2db44a7c890774b0063e20158fd0d9cebf4‚èé
                  f05d40c74afd168d0e8968b14a56c95b0a3b657cbe0ad270170e4154d596c112156c2a9a9fc30898be1f362ca2ce1fe4‚èé
                  e4399ab8ea3735b8f091ada9d613411b54760b7c39c956f225bb9724bd4fd8174a4703151d1b5acf2c979f446d8a3303‚èé
                  6ec652add04478a44f34bab617f15ed40451cf7603ead7f8f58f8e2fc02ca7c75c7d37cbcd9f09811abd881ef16a15e6‚èé
                  bb4e1fe37ff96fe03421286fe37f19120fc66a105fb2b1ee0cbd19feb4e9f20b02fc5d06f6b0d8bbf393da408e2f7e7c‚èé
                  ae536852b5f81690596e78b66ca1ec10af873a8acd62cb716bdb40107019e7f3acb4d11d3e50590c2ca485c0b4a47f0c‚èé
                  28847ee0afaa617284e5ef1fcf9fc5ec00c6cc2404016a565e4154538f93d0adee6cdb72665efb4a319a98dd58dd81e5‚èé
                  2263516a006c037a27ad249ce0efd69e4f6a685a1b6404e95938325bb1b2db35984bc37c4e9751825aaa592089511344‚èé
                  328c84e18a470b718e3a3fa7cd6f06cf2c2352d5e6895c734bf1c8d22eb9c2037378f0609211298f71fa633ed923f31c‚èé
                  934b05ece2375bbf700f4fd30525a20a510b7f0102f24ff2b7eb76ac77d98bc",
    "nonce": "d97c2e3410f37ac7b5dcd8df",
    "recovered_key": "800816b1629bcfa519f57a502a6a841298a9f5c20203d8818fdd18271a3b1682",
    "tag": "76fe172806c0b41816887630ca74f2f8",
    "uncertain_bits_count": 2
}
~~~
AES-256 GCM, med en kryptert melding, tilgjengelig nonce, tilgjengelig tag og tilgjengelig key. Pluss en tag, uncertain_bits_count: 2.
En slurve-tabbe f√∏rer her til at jeg bruker veldig mye tid p√• √• bytte ut bytes isteden for bits.
S√• snart jeg fikk et hint fra Roy Solberg, s√• var denne raskt i boks ved √• flippe bits i n√∏kkelen.   

Flagg: PST{7e7343c9cbe6114f8fd312490816387d}
{:.note}


~~~python
# file: "solver.py"
from Crypto.Cipher import AES
from bitarray import bitarray

vars = {
    "cipher": "aes-256-gcm",
    "ciphertext": "69cf99390e143fbab3ea8326c05b2fde58c964555bd673de10ff4cf2bf49586454b0466afd01c36b0e4dc1e3361d8ff‚èé
                  ec8998d88c13b6ff83798a4607b86f3d14f20f63486d256e65d2164ac90a931d7c36fed071321298ce6eb4206bbc31db‚èé
                  dbd08d72dca0f5ce486e68979f083e0e4f46d1f0eee0fec2aa48de030cb2f2069eb719563443c324b052a913e5007f11‚èé
                  4de4ed7ae44044c03278e2392b46e7815626424d735196f93adc446c4a4a30373e936fa7164112d0867e63e63a4d809d‚èé
                  10e90e805130eb7114422ae17fddd3a272cee6100087fb37eb0268ab187721fc7e8dc8b2b79e91a1d9e276a16bcb79c3‚èé
                  6a7c91b127ea3b08fe57a33ba7d0767e35508b4ab2127aa0a2948cd2a1aace305a49cf63d03a41ca110e9d04636a8595‚èé
                  6aa1b9eac89bc4091ab59bd1ea9d9cd1c225422a7a40ef56d4b65d1e56f138df24dcf74557a72ba055160f82bf39470f‚èé
                  785b12633584ae9639a4352ef08fe5c7f788b0f83021ccf13d7a99a0c088abf72ccc36a30e2447ce10157113a56461bf‚èé
                  afd68be40f6f79dbdf2c901028cfe06a96e5ab9a1121c7e2d8b91e495c9722b2cd97d378844328bfba9870b814df6028‚èé
                  2fec98f70d1639d35205d399d0a858a5cf7210cd9110faecc55c79ae7fe963d908aaa8a34d68b4c0556aeaa4db1ec74c‚èé
                  d321b249602c24dabc961b30ae456199fb1deca09f36cdf8a5d9b0b492e42f7f841cb4627880f9fdd4b2e2d94a553c61‚èé
                  c5c9a0a253a4616af93310eb7a55a74316d595c017cd2953e505d893f85f324a50fecd459e6bce60294aef9e34b7d57c‚èé
                  98f4e9dc5e09a9a6fe620865308d807d767e4c9fec6041b58d003b152d18473e8ce5a9bfe5203b748945a8f4c4683177‚èé
                  b09c6b97603d37451a6220c7cf94fa4cb2f8c26331e08f8b8035acebdeaba4cec24bbdacad448b332ba67d355a91363d‚èé
                  13a4030a7f4e5b3e0d12a5cca08d6431e356a1bf5050c9bb6373a375a58909cb59d851c0da4905a62389aef2809e354f‚èé
                  b2d6b672071ded673f50a3ca475b229999d5a8566e3d7742a271c91f97d8182cb6dcbd3811276cea2386e66b10f047f5‚èé
                  cfd0628e3a55ed420412a4fd1b568ef4a62384694dc6b966defe4226afcc545ff10cd61c181d5df9ce6011995df72a21‚èé
                  9f45ac44eccc63450989df746edbc7165ae008caa158c9298e6c8f8907be02c89313ec55be8eef3521a251518e394071‚èé
                  b9deb5af8d2273cf7fe2ed9ddc96609a8057ca50e5a5c1b0a9b9e4dfa04e58be60feee17632dd713257916416471560c‚èé
                  82da72e49962d1bfcda8db174948765bfc51159e98d38cad9a7ba51a7c8658af998534a6b223d25ba4805c4a12bf0807‚èé
                  e043abc0b47e4562a800b6f79fca703bbd93b1c617d3a8b9244ebfcaffd7f8e44440a20ce1ed7ab8039d5cf182c7c16e‚èé
                  7be51856ac8a516ca25acf79001af3612d7b4d304c2a5b9671620b80db4fedca8df2ec6b57ddbcf4fe9ece3da44bf47e‚èé
                  0f3b21b61f0699e6c38a3169b2890f57636757a894caf22879b1515d1aa00ee8131d3cf7b61ab9c747690bd6ef3d93ed‚èé
                  002c1f3a8e9b7a6b056f76cad42d67ae3f01c1d8d4d8576b950efe65b6312b700f2000f8c3821a70ba1e4800b5bdb422‚èé
                  3f9db27c509495eb638025c4dc898c13ae9f86c944e5428209a111701bc4e2db44a7c890774b0063e20158fd0d9cebf4‚èé
                  f05d40c74afd168d0e8968b14a56c95b0a3b657cbe0ad270170e4154d596c112156c2a9a9fc30898be1f362ca2ce1fe4‚èé
                  e4399ab8ea3735b8f091ada9d613411b54760b7c39c956f225bb9724bd4fd8174a4703151d1b5acf2c979f446d8a3303‚èé
                  6ec652add04478a44f34bab617f15ed40451cf7603ead7f8f58f8e2fc02ca7c75c7d37cbcd9f09811abd881ef16a15e6‚èé
                  bb4e1fe37ff96fe03421286fe37f19120fc66a105fb2b1ee0cbd19feb4e9f20b02fc5d06f6b0d8bbf393da408e2f7e7c‚èé
                  ae536852b5f81690596e78b66ca1ec10af873a8acd62cb716bdb40107019e7f3acb4d11d3e50590c2ca485c0b4a47f0c‚èé
                  28847ee0afaa617284e5ef1fcf9fc5ec00c6cc2404016a565e4154538f93d0adee6cdb72665efb4a319a98dd58dd81e5‚èé
                  2263516a006c037a27ad249ce0efd69e4f6a685a1b6404e95938325bb1b2db35984bc37c4e9751825aaa592089511344‚èé
                  328c84e18a470b718e3a3fa7cd6f06cf2c2352d5e6895c734bf1c8d22eb9c2037378f0609211298f71fa633ed923f31c‚èé
                  934b05ece2375bbf700f4fd30525a20a510b7f0102f24ff2b7eb76ac77d98bc", 
    "nonce": "d97c2e3410f37ac7b5dcd8df",
    "recovered_key": "800816b1629bcfa519f57a502a6a841298a9f5c20203d8818fdd18271a3b1682",
    "tag": "76fe172806c0b41816887630ca74f2f8",
    "uncertain_bits_count": 2
}

def reverse_mask(x):
    x = ((x & 0x55555555) << 1) | ((x & 0xAAAAAAAA) >> 1)
    x = ((x & 0x33333333) << 2) | ((x & 0xCCCCCCCC) >> 2)
    x = ((x & 0x0F0F0F0F) << 4) | ((x & 0xF0F0F0F0) >> 4)
    x = ((x & 0x00FF00FF) << 8) | ((x & 0xFF00FF00) >> 8)
    x = ((x & 0x0000FFFF) << 16) | ((x & 0xFFFF0000) >> 16)
    return x

max = (len(bytearray.fromhex(vars["recovered_key"])) * 8)
for c1 in range(0, max):
    print("c1:" + str(c1))
    for c2 in range(c1, max):
        keyBytes = bytearray.fromhex(vars["recovered_key"])
        char1Idx = int(c1 / 8)
        bit1Index = c1 - char1Idx * 8
        keyBytes[char1Idx] = keyBytes[char1Idx] ^ 1 << bit1Index
        char2Idx = int(c2 / 8)
        bit2Index = c2 - char2Idx * 8
        keyBytes[char2Idx] = keyBytes[char2Idx] ^ 1 << bit2Index

        nonceBytes = bytearray.fromhex(vars["nonce"])
        cipherBytes = bytearray.fromhex(vars["ciphertext"])
        tagBytes = bytearray.fromhex(vars["tag"])
        cipher = AES.new(keyBytes, AES.MODE_GCM, nonce=nonceBytes)
        plaintext = cipher.decrypt(cipherBytes)
        # print(plaintext.decode('iso-8859-1'))
        try:
            cipher.verify(tagBytes)
            print("Bits in pos " + str(c1) + " and " + str(c2) + " must be flipped.")
            print("The message is authentic:", plaintext.decode('utf-8'))
            exit()
        except ValueError:
            a = 0
            # print("Key incorrect or message corrupted")
~~~
    Bits in pos 148 and 174 must be flipped.
    The message is authentic: Ôªø
    SPST
    21.12.19
    
    Kantinesituasjonen
    Kantinen har n√• landet avtale med ny r√•vareleverand√∏r, og f√∏rste leveranse blir idag. 
    Det blir alts√• vintersolverv-torsk som planlagt.
    
    Lekkasje fra SPSTs interne nettverk
    I forbindelse med angrepet mot stordatamaskinen som startet 12.12.19, ble det eksfiltrert en mindre mengde 
    dokumenter gradert TEMMELIG HEMMELIG. 
    Som en konsekvens av dette har vi fra idag tatt i bruk en ny krypteringsalgoritme 
    for data i bevegelse. Vi har opplevd litt problemer med de dedikerte linjene for overf√∏ring av n√∏kkelmateriell, 
    men leverand√∏ren v√•r jobber p√• spreng for √• fikse dette.
    
    
    Ytterligere operasjoner mot NPST
    - L√∏rdag 14.12.19 fikk en av v√•re dyktige kildef√∏ringspingviner informasjon om NPSTs planlagte julebord. 
    Vi har ikke lykkes i √• bekrefte informasjonen, men kilden forteller at det skal konkurreres i hammerdistanse
    - Tirsdag 17.12.19 ble det gjennomf√∏rt en vellykket sabotasjeaksjon mot NPSTs matlager. 
    Her ble passordet skiftet til rudolf2, og hashing-algoritme byttet ut med MD5. 
    Det vurderes som MULIG at dette vil p√•virke julen.
    - Onsdag 18.12.19 ble det som en HOAX/avledningsoperasjon plassert 
    en helt vanlig ponni i reinsdyrstallen til Jule NISSEN. 
    Dette vil trolig kunne p√•virke julen ytterligere.
    
    
    Ukens ansatt
    Denne ukens ansatt √∏nsker ikke √• opptre med navn, 
    men vi kan avsl√∏re at pingvinen jobber ved SPSTs PINGINT-seksjon, 
    og har gjort en utmerket jobb med kildene sine den siste tiden.
    
    
    Takk til alle for utmerket arbeid uka som har v√¶rt.
    Sjef SPST, Keiserpingvinen
    
    FLAGG: PST{7e7343c9cbe6114f8fd312490816387d}

## Luke 22
### 22. desember
    Opptrapping av falske nyheter
    SPST har den siste tiden trappet opp sin p√•g√•ende falske nyhets-kampanje. som, i f√∏lge betrodde kilder, 
    refereres til som "Operasjon Avlys julen" internt hos SPST. Det er kritisk at vi f√•r stoppet denne operasjonen 
    s√• rask som mulig, men forel√∏pig har vi ikke helt oversikt over hva dette inneb√¶rer.
    
    Analytikerne v√•re mener det kanskje ligger noe gjemt p√• SPST sin kampanje-side, 
    men dessverre greier ikke agentene v√•re √• finne noe. Kunne noen alvebetjeneter sett om de finner noe der?
    
    https://spst.no

Her har vi alts√• en kampanjeside. En rask titt p√• robots.txt gir oss:
    
    User-agent: *
    Disallow: /temmelig-hemmelig/
    
`https://spst.no/temmelig-hemmelig/` gir oss flagget direkte p√• siden.   


Flagg: PST{fc35fdc70d5fc69d269883a822c7a53e}
{:.note}

### Kildekode (15)
Joda, source koden til websiden inneholder en skjult tag:
~~~html
<span id="forkongithub"><a href="https://github.com/SydpolarSikkerhetstjeneste/spst.no">üç¥ meg p√• GitHub</a></span>
~~~
Kildekoden er tilgjengelig p√• github, og ved √• g√• gjennom historikken, finner vi at n√∏kkelen var `pingvinerbestingenprotest`,
har blitt endret til morse med regex pattern `[ -\.]+`. Cyberchef er nok en gang mitt goto-tool. Ved √• legge
inn korrekt morsekode p√• denne siden f√•r vi:
    
    Til Pen Gwyn
    Fra Keiserpingvinen
    
    Alt ligger i vedlagt bilde.

Flagget ligger bokstavelig talt i alt-tag til bildet.  


Flagg: PST{f2e0e89f59722af1f388529720b9db03}
{:.note}

Bildet er ogs√• av en gul lapp med teksten `CO NG RA TS`. I tillegg ser det ut til at det er noen spesielle kabler i bildet, 
sannsynligvis [ENIGMA](https://en.wikipedia.org/wiki/Enigma_machine) kabler (du har vel sett [The Imitation Game](https://en.wikipedia.org/wiki/The_Imitation_Game)?).

### &npsp; (20)
    V√•re analytikere mener SPST kan ha skjult informasjon for hackere som deg.

Denne er litt tricky, men veldig g√∏y. Jeg har stort sett v√¶rt gjennom alt p√• websidene fram til n√•, s√• det eneste som 
kan inneholde skjult informasjon m√• jo v√¶re bildet. zsteg viser at det kan v√¶re noe i `b1,rgb,lsb,xy`, ser iallefall ut til 
√• v√¶re lange linjer og et linjeskift. En extract viser at det ser ut til √• v√¶re en [QR kode](https://en.wikipedia.org/wiki/QR_code).
~~~bash
$ zsteg -E b1,rgb,lsb,xy 95728ce2159815f2e2a253c664b2493f.png > qr-code.txt
~~~
For √• lese av QR koden erstatter jeg 'S' med '‚ñà', √•pner opp i firefox, 
lager en skjermdump, √•pner denne i [gimp](https://www.gimp.org/), reskalerer slik at qr koden er kvadratisk, 
bruker en QR leser p√• mobiltelefonen til √• lese av koden og tilslutt
kopierer resultatet til meg selv. QR koden representerer en URL, ser det ut til `/8a2a8e12017977d9dbf0ed33e254e94e.txt`.

    These aren't the Penguins you're looking for
    
    
                 a8888b.
                d888888b.
                8P"YP"Y88
                8|o||o|88
                8'    .88
                8`._.' Y8.
               d/      `8b.
             .dP   .     Y8b.
            d8:'   "   `::88b.
           d8"           `Y88b
          :8P     '       :888
           8a.    :      _a88P
         ._/"Yaa_ :    .| 88P|
         \    YP"      `| 8P  `.
        /     \._____.d|    .'
         `--..__)888888P`._.'

Det ser tilsynelatende ut som en standard feilmeldings-side, men skinnet kan bedra. Den gir faktisk ikke 404 Not Found, 
men derimot 200 OK. Ved √• laste ned filen og ta en n√¶rmere titt p√• den, kan man se at den inneholder en rekke bytes som
ikke tilsvarer noen karakterer.
Ved √• kj√∏re litt nummeranalyse p√• disse bytes, kan jeg se at det er 888 bytes totalt. Jeg kan ogs√• se at det er et m√∏nster, 
det ser ut til at tallene opptrer i grupper p√• 3 og 3. UTF-8/Unicode er det ikke, ei heller RGB. Ved √• sjekke antall av unike grupper,
kan jeg se at det er kun 4 unike grupperinger. Jeg fors√∏ker base 4 p√• de tre f√∏rste gruppene, og f√•r PST som resultat. 
L√∏sningen er alts√• base4 enkodet, erstattet med en gruppering p√• 3 bytes og printet ut.
Ved √• reversere dette finner vi det siste flagget.  

Flagg: PST{67b8601a11e47a9ee3bf08ddfd0b79ba}
{:.note}

~~~python
# file: "solver.py"
import string
from PIL import Image
import numpy as np

with open("8a2a8e12017977d9dbf0ed33e254e94e.txt", "rb") as f:
    bytes = f.read()
    other = []
    for b in bytes:
        if chr(b) in string.printable:
            print(chr(b), end='')
        else:
            other.append(b)

# OK, the first letter should be P.
# the first 24 values represent this somehow.
# lets see if we find a pattern:
print("")
# we have these unique combos (subtracted with the base value):
# 0,0,0 - 0
# 0,0,1 - 1
# 0,0,32 - 2
# 13,59,51 - 3

# what happens if we decode to base4? I think I got it!
# 80 - 83 - 84


i = 0
base1 = 226
base2 = 128
base3 = 140
line = ''
lines = []
while i < 888:
    num1 = other[i]
    num2 = other[i+1]
    num3 = other[i+2]
    if i % 24 == 0 and i!=0:
        lines.append(line)
        line = ''
    num_base1 = num1 - base1
    num_base2 = num2 - base2
    num_base3 = num3 - base3
    actual = 0
    if num_base1 == 0 and num_base2==0 and num_base3 == 0:
        actual = 0
    elif num_base1 == 0 and num_base2 == 0 and num_base3 == 1:
        actual = 1
    elif num_base1 == 0 and num_base2 == 0 and num_base3 == 32:
        actual = 2
    elif num_base1 == 13 and num_base2 == 59 and num_base3 == 51:
        actual = 3
    else:
        print("agh!")
        exit()
    line+=str(actual)
    i = i + 3
lines.append(line)

for line in lines:
    print(chr(int(line, 4)), end='')
print("")
~~~

## Luke 23
### Fragmentert samtale (5)
    Fragmentert samtale
    
    Arbeidet som ble gjort 21. desember rundt avdekking av feil ved SPST sitt nye kryptosystem, 
    har gjort oss i stand til √• snappe opp en samtale mellom to h√∏ytst√•ende SPST-agenter. 
    Teknikerne v√•re er dessverre p√• ferie, og vi greier ikke dekode meldingen helt, kunne noen alvebetjenter h√∏rt p√• det?
    Vi har misstanke om at det utveksles en kode, og at denne koden kan benyttes for √• finn'e en artikkel av noe slag. 
    Analytekerne v√•re mener det er artikkelens navn som er av interesse. Om noen finner ut av det, 
    legg inn md5-hashen av tittelen p√• artikkelen dere finn'er.
    
    Last ned PCAP
    
    Eksempel:
    tittel: "Gl√∏gg og pepperkaker" ‚Üí svar: PST{md5("Gl√∏gg og pepperkaker")} = PST{9612ad6af8b6d78045b840b3c477d004}

Vi f√•r en zip-fil med en [pcap](https://en.wikipedia.org/wiki/Pcap) og en tekstfil.
    
    INVITE sip:24700720@10.143.23.244:5060 SIP/2.0
    Max-Forwards: 59
    Via: SIP/2.0/UDP 10.22.48.6:5060;branch=z9hG4bKg3Zqkv7iqzibm3wfn8td5orxo7vyxe5q9
    To: <tel:24700720;phone-context=+47>
    From: "Anonymous" <sip:anonymous@anonymous.invalid>;tag=h7g4Estg_p63344t1976798986m456675c4958193147s1_3997725510-548775950
    Call-ID: p65599t1576767456m455575f2658294147s2
    CSeq: 1 INVITE
    Contact: <sip:sgc_c@10.22.48.6;transport=udp>;+g.3gpp.icsi-ref="urn%3Aurn-7%3A3gpp-service.ims.icsi.mmtel"
    Record-Route: <sip:10.22.48.6;transport=udp;lr>
    Accept-Contact: *;+g.3gpp.icsi-ref="urn%3Aurn-7%3A3gpp-service.ims.icsi.mmtel"
    Min-Se: 900
    Resource-Priority: q735.4
    Session-Expires: 1800
    Supported: timer
    Supported: 100rel
    Supported: precondition
    Supported: histinfo
    Content-Type: application/sdp
    Content-Length: 421
    Session-ID: 5b8e6d5f89b8ea975b77e0a6bbf782a8
    Allow: REGISTER, REFER, NOTIFY, SUBSCRIBE, PRACK, UPDATE, INVITE, ACK, OPTIONS, CANCEL, BYE
    Accept: application/sdp
    
    v=0
    o=- 2022048203 3887725258 IN IP4 10.22.48.6
    s=-
    c=IN IP4 10.64.65.129
    t=0 0
    a=sendrecv
    m=audio 45248 RTP/AVP 97 100 105
    c=IN IP4 10.64.65.129
    a=curr:qos local none
    a=curr:qos remote none
    a=des:qos mandatory local sendrecv
    a=des:qos optional remote sendrecv
    a=rtpmap:97 PCMA/8000
    a=rtpmap:100 telephone-event/16000
    a=fmtp:100 0-15
    a=rtpmap:105 telephone-event/8000
    a=fmtp:105 0-15
    a=maxptime:40
    
S√• det ser ut til at vi har f√•tt en pcap av en lydsamtale med protokollen [RTP](https://en.wikipedia.org/wiki/Real-time_Transport_Protocol)
med [PCMA](https://tools.ietf.org/html/rfc3551#section-4.5.14) payload p√• 8000 Hz.
Jeg √•pner pcap filen i [wireshark](https://www.wireshark.org/), spesifiserer at det er RTP istedenfor UDP, 
s√• f√•r jeg faktisk opp at dette er en samtale mellom to parter. Jeg f√•r ikke til √• spille av lyd i min wireshark, 
s√• jeg eksporterer i RAW format, og importerer dette til [audacity](https://www.audacityteam.org/).
Her finner jeg egentlig ikke ut av s√• mye, men etter litt konferering med Roy Solberg, s√• var det en enklere m√•te
√• l√∏se denne p√•, det er masse hint til finn, og PST hadde kun tre annonser ute denne dagen, s√• det var bare √• pr√∏ve tittelen
p√• alle tre, s√• kom man fram til riktig flagg.
Jeg ser i etterkant at jeg var inne p√• den p√•tenkte l√∏sningen, [her er en beskrivelse](https://github.com/myrdyr/ctf-writeups/tree/master/npst#fragmentert-samtale).  

`PST{0844d949169d24679a1f0438f89c69e3}`
{:.note}
### Mystisk julekort (5)
    Mystisk julekort
    
    Jule NISSEN fikk i g√•r et meget spesielt julekort levert i den elektroniske postkassen hans. 
    Julekortet har ingen bakside, og derfor heller ingen tekst knyttet til seg.
    Klarer du √• finne ut noe mer om avsender e.l.?

Eneste oppgaven jeg ikke l√∏ste, og jeg ser i etterkant at jeg var langt ifra √• finne korrekt l√∏sning.
Awesome writeup av l√∏sningen [finner du her](https://github.com/myrdyr/ctf-writeups/tree/master/npst#mystisk-julekort).

## 24. desember (24)
    Operasjon Avlys julen
    Situasjonen rundt SPSTs operasjon "Avlys julen" har eskalert, 
    og vi m√• sette inn umiddelbare tiltak for √• f√• stoppet den. 
    Betrodde kilder sier det hele styres fra SPSTs digitale operasjonssentral. 
    Keiserpingvinens mange reiser ryktes det at operasjonssentralen er √•pent tilgjengelig fra hele verden, 
    men at den er beskyttet med avansert kryptografi.
    Kan noen av alvebetjentene se om greier √• spore opp SPST sin operasjonssentral, 
    hacke seg inn og avbryte operasjonen deres?

Endelig til slutten! Det har v√¶rt mange oppgaver, en fin blanding av enkle, vanskelige og ultra-vanskelige (23 - Mystisk julekort).
Denne oppgaven hadde jeg ogs√• problemer med, men klarte den til slutt med fine hint ifra Roy Solberg.
Ikke s√• mye informasjon √• g√• p√•, men la oss gjette p√• at vi trenger enten √• finne et subdomene eller en katalog.
Jeg setter igang directory enumeration med [gobuster](https://github.com/OJ/gobuster) 
og subdomain enumeration med [dnsenum](https://github.com/fwaeytens/dnsenum), 
og finner til slutt et nytt subdomene, `ops.spst.no`
~~~bash
$ dnsenum -f /usr/share/seclists/Discovery/DNS/namelist.txt --threads 50 --noreverse spst.no
~~~
Der f√•r vi presentert en side med en sjenert knapp. litt kildekode inspisering sier oss at URL-en er:
`https://ops.spst.no/api/abort`. Denne siden gir oss tilbake en kryptert melding, tydeligvis:

    SAXVC OIWPT GQOJZ OXEHI ZVCWU NCCOW FIKVP NOENT CETAU IKPCM ZLOYP BJHEC KPEXG RJWDO DJBBI HQDTG FFBQV LJAZC ZOFIC 
    ZAIWJ QEVCL FXAVC PDUWT GBIGM SSWAO OXJHP PLKXH TGQAY COIQL ZSWIL HKMYR YMPZZ PTIEL PSRIP YVRKC DINBR WJZJP HHNXM 
    HGYWN XXIGB UTTOX AEPKZ TUCMC MGFHC WHSAY KFVVS PDBFE KABAB PNBVR IZGTX PERJZ GDHQJ JDUYV FAOYV JWZOU WXXPR HVDLL 
    BQTJI HULQP ACIXG NUPUS PCKHT LOKLN ZCLZO QVWSL HPBWD ATZES JEITM AJIFU SIVVF PHPEN UYHZK AWIZY MNQLH ZVKJJ EEYSZ 
    LLUEM NZAFA OZXYL WBRPX JUKQG KIEXX CDYAT IHVJK HOMGI UVAOQ PBXRN HAAWG XOBAZ UILJB KYSBP IOBKH GYZBD IPQNG VSUTS 
    YXOGY KEIKK TIKKQ RFVWQ NBCEK TIJLC CXRDB TUNXT SBKWR YDBR
    
La oss h√•pe p√• at vi n√• f√•r bruk for alle kodene p√• de gule lappene vi har funnet (ser mistenkelig ut som enigma innstillinger):  
`IV PS ‚öôÔ∏è`  
`VII TF ‚öôÔ∏è`  
`VII TW ‚öôÔ∏è`  
`CO NG RA TS`  
Vi gjettet korrekt, ved √• punche inn kodene over i [Cyberchef Enigma](https://gchq.github.io/CyberChef/#recipe=Enigma('3-rotor','LEYJVCNIXWPBQMDRTAKZGFUHOS','A','A','ESOVPZJAYQUIRHXLNFTGKDCMWB%3CK','P','S','NZJHGRCXMYSWBOUFAIVLPEKQDT%3CAN','T','F','NZJHGRCXMYSWBOUFAIVLPEKQDT%3CAN','T','W','AY%20BR%20CU%20DH%20EQ%20FS%20GL%20IP%20JX%20KN%20MO%20TZ%20VW','CO%20NG%20RA%20TS',true)&input=U0FYVkMgT0lXUFQgR1FPSlogT1hFSEkgWlZDV1UgTkNDT1cgRklLVlAgTk9FTlQgQ0VUQVUgSUtQQ00gWkxPWVAgQkpIRUMgS1BFWEcgUkpXRE8gREpCQkkgSFFEVEcgRkZCUVYgTEpBWkMgWk9GSUMgWkFJV0ogUUVWQ0wgRlhBVkMgUERVV1QgR0JJR00gU1NXQU8gT1hKSFAgUExLWEggVEdRQVkgQ09JUUwgWlNXSUwgSEtNWVIgWU1QWlogUFRJRUwgUFNSSVAgWVZSS0MgRElOQlIgV0paSlAgSEhOWE0gSEdZV04gWFhJR0IgVVRUT1ggQUVQS1ogVFVDTUMgTUdGSEMgV0hTQVkgS0ZWVlMgUERCRkUgS0FCQUIgUE5CVlIgSVpHVFggUEVSSlogR0RIUUogSkRVWVYgRkFPWVYgSldaT1UgV1hYUFIgSFZETEwgQlFUSkkgSFVMUVAgQUNJWEcgTlVQVVMgUENLSFQgTE9LTE4gWkNMWk8gUVZXU0wgSFBCV0QgQVRaRVMgSkVJVE0gQUpJRlUgU0lWVkYgUEhQRU4gVVlIWksgQVdJWlkgTU5RTEggWlZLSkogRUVZU1ogTExVRU0gTlpBRkEgT1pYWUwgV0JSUFggSlVLUUcgS0lFWFggQ0RZQVQgSUhWSksgSE9NR0kgVVZBT1EgUEJYUk4gSEFBV0cgWE9CQVogVUlMSkIgS1lTQlAgSU9CS0ggR1laQkQgSVBRTkcgVlNVVFMgWVhPR1kgS0VJS0sgVElLS1EgUkZWV1EgTkJDRUsgVElKTEMgQ1hSREIgVFVOWFQgU0JLV1IgWURCUg), f√•r vi ut en rekke med engelske tall.

    FIVEZ EROSI XNINE SIXSE VENSI XSEVE NTWOZ EROSI XONES EVENS IXTWO ONEZE ROAFO URNIN ESIXE SIXSE VENSI XFIVE SIXET 
    WOZER OSIXT WOSIX FSIXB SEVEN THREE SEVEN FOURS IXONE SEVEN SIXSI XBSIX ASIXF IVESI XBSEV ENTHR EETWO EZERO AFOUR 
    CSIXF IVESE VENFO URTWO ZEROS IXNIN ETWOZ EROSI XEIGH TSIXF IVESE VENEI GHTTW OZERO SEVEN ZEROC THREE AFIVE TWOZE 
    ROSIX SIXCT HREEB EIGHT SIXCS IXSEV ENSIX FIVES IXESI XFOUR SIXFI VETWO ZEROS EVENT WOSIX FIVES IXSEV ENSIX FIVES 
    EVENE IGHTT HREEA TWOZE ROFIV EBFIV ECSIX FOURS IXONE TWODS IXSIX FIVED SEVEN BTHRE ETWOS EVEND FIVEC TWOES EVENT 
    HREES EVENZ EROSE VENTH REESE VENFO URFIV ECTWO ESIXE SIXF
Et lite python program som s√∏ker og erstatter gir oss:

    50696767206176210A496E67656E20626F6B737461766B6A656B732E0A4C65742069206865782070C3A52066C3B86C67656E64652072656765783A205B5C64612D665D7B327D5C2E737073745C2E6E6F

Som kan enkelt konverteres til tekst vha [Cyberchef](https://gchq.github.io/CyberChef/#recipe=From_Hex('None')&input=NTA2OTY3NjcyMDYxNzYyMTBBNDk2RTY3NjU2RTIwNjI2RjZCNzM3NDYxNzY2QjZBNjU2QjczMkUwQTRDNjU3NDIwNjkyMDY4NjU3ODIwNzBDM0E1MjA2NkMzQjg2QzY3NjU2RTY0NjUyMDcyNjU2NzY1NzgzQTIwNUI1QzY0NjEyRDY2NUQ3QjMyN0Q1QzJFNzM3MDczNzQ1QzJFNkU2Rg) 
(det er r√• hex verdier), som gir oss neste steg:
    
    Pigg av!
    Ingen bokstavkjeks.
    Let i hex p√• f√∏lgende regex: [\da-f]{2}\.spst\.no

Masse testing, feiling og banning senere, s√• kom jeg et steg videre. p√• domenene fra `00.spst.no` opp til `ff.spst.no`
s√• finnes det [TXT records og CNAME records](https://en.wikipedia.org/wiki/List_of_DNS_record_types).
Jeg hentet ut TXT og CNAME recordene med [dig](https://en.wikipedia.org/wiki/Dig_(command)).
En TXT record inneholder en bokstav, mens en CNAME record inneholder en annen dns entry, eksempelvis `aa.spst.no`.
En CNAME record inneholder den spesielle DNS entry: `slutt.spst.no`
Enda mere testing feiling og banning senere kom jeg fram til at alle 256 entries i CNAME recordene dannet en "self referencing chain".
S√•, ved √• splitte opp i hex-fra og hex-til, "slutt" er i hex-til, s√• har vi den siste hex entry. s√• finner vi denne i hex-til og 
plukker hex-fra. Slik fortsetter vi inntill vi har plukket alle hex verdier.
ved √• rokkere om TXT entriene basert p√• denne rekkef√∏lgen f√•r vi:
    
    bokstav=edG1y9Dq9ram2hb0mQYNT4wcWeNXRkY22JU7wa6qFJqkWMLRF0nxeFZNr02jxpJ7ZIzVeWnwe60pbSKLXcwvbV23yFOdN4aPXCV6GHN4fYnzswDTAop3O8vTEEDJFOeuKdBVWGcWy7LDcsucwz8nBHbR9UG9CP4zpMZLQPvEl1eu4Tp9Lto4zuA0ijU2eLk0qQBlRQdxZKrajIqiW5P1K1HkKrjgGIj4M7xP7Sg3pSNXLklGm4LBBbhG

Noe kjent er det iallefall, og leser vi litt tilbake, s√• tyter api/abort over "Ingen bokstavkjeks", som sannsynligvis 
betyr "Du mangler en cookie med navn 'bokstav'".
Klem inn denne verdien som cookie, og vi f√•r et annet resultat.
    
    Arrgh! Vi gir opp for denne gang.
    https://npst.no/_6331fff126233c324c9f5fc49c49a8b6.html

Flagg: PST{82a1f79e6ce39ef16d0ef4ef1c1d2fcc}
{:.note}
![star wars](/assets/img/blog/2020-npst/24-final-scene.png)

## Til slutt
Jeg satt virkelig fast p√• noen oppgaver, og brukte Roy Solberg ([Twitter](https://twitter.com/roysolberg), [Blog](https://blog.roysolberg.com/)) som en veldig kjekk "rubber duck" og hint master. 
Uten hans hjelp hadde jeg nok ikke kommet videre p√• en del av oppgavene.

üôåüôå Takk for at du tok deg tid til √• lese alt, trykk p√• recommend og legg inn en kommentar! üôåüôå